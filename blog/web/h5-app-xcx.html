<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>H5-APP-小程序三端交互 | crise&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./assets/logo.png">
    <meta name="description" content="一名程序员/前端人的技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.567624d3.css" as="style"><link rel="preload" href="/assets/js/app.92dc81f6.js" as="script"><link rel="preload" href="/assets/js/2.2d54ebdc.js" as="script"><link rel="preload" href="/assets/js/21.1b255fe0.js" as="script"><link rel="prefetch" href="/assets/js/10.01084cac.js"><link rel="prefetch" href="/assets/js/11.bac0121f.js"><link rel="prefetch" href="/assets/js/12.4e876679.js"><link rel="prefetch" href="/assets/js/13.d3fce123.js"><link rel="prefetch" href="/assets/js/14.75510bd2.js"><link rel="prefetch" href="/assets/js/15.48750021.js"><link rel="prefetch" href="/assets/js/16.7952a809.js"><link rel="prefetch" href="/assets/js/17.10b72fbd.js"><link rel="prefetch" href="/assets/js/18.13c83f7d.js"><link rel="prefetch" href="/assets/js/19.31948ab8.js"><link rel="prefetch" href="/assets/js/20.dc4c0c1c.js"><link rel="prefetch" href="/assets/js/22.2f1d66a8.js"><link rel="prefetch" href="/assets/js/23.cf0fa840.js"><link rel="prefetch" href="/assets/js/24.9cf68851.js"><link rel="prefetch" href="/assets/js/25.c501abdb.js"><link rel="prefetch" href="/assets/js/26.5f6dd563.js"><link rel="prefetch" href="/assets/js/27.74260c5a.js"><link rel="prefetch" href="/assets/js/28.ce8f13bc.js"><link rel="prefetch" href="/assets/js/29.06bdce57.js"><link rel="prefetch" href="/assets/js/3.e9d5348e.js"><link rel="prefetch" href="/assets/js/30.8204335f.js"><link rel="prefetch" href="/assets/js/31.01971e34.js"><link rel="prefetch" href="/assets/js/32.c9d7df95.js"><link rel="prefetch" href="/assets/js/33.96b6de7c.js"><link rel="prefetch" href="/assets/js/34.b813165e.js"><link rel="prefetch" href="/assets/js/35.615aded7.js"><link rel="prefetch" href="/assets/js/36.9c619b20.js"><link rel="prefetch" href="/assets/js/37.90ffb782.js"><link rel="prefetch" href="/assets/js/38.1967fbbd.js"><link rel="prefetch" href="/assets/js/39.0d735efe.js"><link rel="prefetch" href="/assets/js/4.ca421095.js"><link rel="prefetch" href="/assets/js/40.923e5594.js"><link rel="prefetch" href="/assets/js/41.fd7797b4.js"><link rel="prefetch" href="/assets/js/42.7177cfca.js"><link rel="prefetch" href="/assets/js/43.b745c235.js"><link rel="prefetch" href="/assets/js/44.6fa2e561.js"><link rel="prefetch" href="/assets/js/45.9ecc0f19.js"><link rel="prefetch" href="/assets/js/46.d47edb5a.js"><link rel="prefetch" href="/assets/js/47.f48a72bc.js"><link rel="prefetch" href="/assets/js/48.19da9fb3.js"><link rel="prefetch" href="/assets/js/49.a5d16804.js"><link rel="prefetch" href="/assets/js/5.1898d05c.js"><link rel="prefetch" href="/assets/js/50.5efb3589.js"><link rel="prefetch" href="/assets/js/51.6a21aa98.js"><link rel="prefetch" href="/assets/js/52.2947ff47.js"><link rel="prefetch" href="/assets/js/53.dc63262e.js"><link rel="prefetch" href="/assets/js/54.fa9b8371.js"><link rel="prefetch" href="/assets/js/55.d0f31e05.js"><link rel="prefetch" href="/assets/js/56.de8ec14d.js"><link rel="prefetch" href="/assets/js/57.73331274.js"><link rel="prefetch" href="/assets/js/58.4f67425f.js"><link rel="prefetch" href="/assets/js/59.318ec5bd.js"><link rel="prefetch" href="/assets/js/6.c999d008.js"><link rel="prefetch" href="/assets/js/60.f6a602f9.js"><link rel="prefetch" href="/assets/js/61.c659faf6.js"><link rel="prefetch" href="/assets/js/62.4ccc91f2.js"><link rel="prefetch" href="/assets/js/63.6e5e36a9.js"><link rel="prefetch" href="/assets/js/64.2660e08e.js"><link rel="prefetch" href="/assets/js/65.b06b0bed.js"><link rel="prefetch" href="/assets/js/66.1f836a7a.js"><link rel="prefetch" href="/assets/js/67.add88f29.js"><link rel="prefetch" href="/assets/js/68.e74a51fc.js"><link rel="prefetch" href="/assets/js/69.63126800.js"><link rel="prefetch" href="/assets/js/7.92efcfae.js"><link rel="prefetch" href="/assets/js/70.1dc8f877.js"><link rel="prefetch" href="/assets/js/71.856f3fe1.js"><link rel="prefetch" href="/assets/js/72.927e4ce2.js"><link rel="prefetch" href="/assets/js/73.2c1e909e.js"><link rel="prefetch" href="/assets/js/74.c8b565d2.js"><link rel="prefetch" href="/assets/js/75.00537c0a.js"><link rel="prefetch" href="/assets/js/76.492fbce1.js"><link rel="prefetch" href="/assets/js/77.6fb48b9b.js"><link rel="prefetch" href="/assets/js/78.d5aea725.js"><link rel="prefetch" href="/assets/js/8.81eb0648.js"><link rel="prefetch" href="/assets/js/9.1bebc5a8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.567624d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">crise's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>web跨端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/web/universal-link.html" class="sidebar-link">Universal Link（针对 ios9+系统 h5 浏览器唤起 app 使用）</a></li><li><a href="/blog/web/miniprogram.html" class="sidebar-link">小程序跨端方案</a></li><li><a href="/blog/web/evoke.html" class="sidebar-link">H5 唤起 app</a></li><li><a href="/blog/web/h5-app-xcx.html" aria-current="page" class="active sidebar-link">H5-APP-小程序三端交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/h5-app-xcx.html#导语" class="sidebar-link">导语</a></li><li class="sidebar-sub-header"><a href="/blog/web/h5-app-xcx.html#常见的跳转方式" class="sidebar-link">常见的跳转方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/h5-app-xcx.html#h5-app-双向通信" class="sidebar-link">H5-APP 双向通信</a></li><li class="sidebar-sub-header"><a href="/blog/web/h5-app-xcx.html#h5-小程序" class="sidebar-link">H5-小程序</a></li><li class="sidebar-sub-header"><a href="/blog/web/h5-app-xcx.html#app-h5-小程序" class="sidebar-link">APP-h5-小程序</a></li><li class="sidebar-sub-header"><a href="/blog/web/h5-app-xcx.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架与原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机与网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维与安全</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="h5-app-小程序三端交互"><a href="#h5-app-小程序三端交互" class="header-anchor">#</a> H5-APP-小程序三端交互</h1> <h2 id="导语"><a href="#导语" class="header-anchor">#</a> 导语</h2> <ul><li>APP 运营角色：提供完整功能</li> <li>h5 运营角色：引流，跨平台，产品/品牌推广传播</li> <li>小程序运营角色：依托超级 APP 获取用户，提供超级 APP web 化解决方案满足用户需求</li></ul> <p>本文主要聊聊h5、APP和小程序之间的三端通信解决方案，重要性不必多说，直接上干货。</p> <h2 id="常见的跳转方式"><a href="#常见的跳转方式" class="header-anchor">#</a> 常见的跳转方式</h2> <ol><li>H5 &lt;=&gt; APP</li> <li>H5 &lt;=&gt; 小程序</li> <li>小程序 &lt;=&gt; APP</li> <li>小程序 &lt;=&gt; H5 &lt;=&gt; APP</li></ol> <h3 id="h5-app-双向通信"><a href="#h5-app-双向通信" class="header-anchor">#</a> H5-APP 双向通信</h3> <p>这里可以分为两部分，一种是 h5 页面在浏览器内打开，跳转至 app；另一种是 h5 页面在 app 内部 webview 打开，然后跳转至 app 原生页面</p> <h4 id="_1-概念"><a href="#_1-概念" class="header-anchor">#</a> 1. 概念：</h4> <ul><li><a href="/blog/web/evoke.html#url-scheme-是什么">scheme 协议</a></li> <li><a href="/blog/web/universal-link.html">universal 协议</a></li> <li><a href="https://www.cnblogs.com/pqjwyn/p/7120342.html" target="_blank" rel="noopener noreferrer">webview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="_2-h5-浏览器内-app"><a href="#_2-h5-浏览器内-app" class="header-anchor">#</a> 2. H5(浏览器内) &lt;-&gt; APP</h4> <ul><li>简单的说就是通过 scheme/universal 协议 url，尝试唤起 app，然后跳转到指定 app 页面（原生页，h5 页皆可），</li></ul> <p>详细实现方案 -&gt; <a href="/blog/web/evoke.html">H5 跳转 app</a></p> <ul><li>App 跳转到 h5 页面，可以通过分享链接方式，在浏览器打开</li></ul> <h4 id="_3-h5-webview-app-原生页面"><a href="#_3-h5-webview-app-原生页面" class="header-anchor">#</a> 3. H5(webview) -&gt; APP(原生页面)</h4> <ul><li><p>在 app 内部通过 scheme/universal 协议 url 跳转到指定 app 原生页面。app 内部跳转使用 scheme 协议，省去了第一次的授权工作，无需用户同意，直接跳转。</p> <p>途家实现方案：无论 andriod/ios 都使用 <a href="">https://app.xxx.com/go/xxx</a> 进行跳转，ios9+使用这个没有问题，andriod 或 ios9-版本会将这个 url 转化成 scheme 协议 <a href="">tujia://com.xxx.hotel/</a>,然后跳转</p> <p>我司实现方案：无论andriod/ios 先尝试跳转scheme地址：<code>xxx://openapi/</code>，然后setTimeout隔一段时间，再去打开下载落地页（<code>http://m.xxx.com/www/download/app/</code>）。
然后再根据不同端看是直接下载apk链接，还是跳转应用宝地址，还是打开app store商城。</p></li> <li><p>App 跳转到 h5 页面(webview)，andriod 通过普通方式跳转即可：webView.loadUrl(url)，ios 跳转方法...</p></li></ul> <h3 id="h5-小程序"><a href="#h5-小程序" class="header-anchor">#</a> H5-小程序</h3> <h4 id="_1-h5-小程序"><a href="#_1-h5-小程序" class="header-anchor">#</a> 1. H5 -&gt; 小程序</h4> <p>小程序码生成接口:</p> <div class="language-api extra-class"><pre class="language-text"><code>  POST https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=ACCESS_TOKEN&amp;scene=string
</code></pre></div><ul><li><p>h5 页面在微信打开，可以通过在页面底部种小程序码的方式，让用户通过识别生成的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html" target="_blank" rel="noopener noreferrer">小程序码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或小程序二维码进入小程序，小程序开发者可通过获取小程序码/二维码 <code>page</code> 值，跳转到相应的页面，通过<code>scene</code>值，进行相应的逻辑处理</p></li> <li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html?search-key=web-view" target="_blank" rel="noopener noreferrer">h5(小程序 webview)跳转小程序原生页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ol><li>引入小程序 sdk</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://res.wx.qq.com/open/js/jweixin-1.3.2.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>根据逻辑跳转</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>wx<span class="token punctuation">.</span>miniProgram<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/path/to/page'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
wx<span class="token punctuation">.</span>miniProgram<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
wx<span class="token punctuation">.</span>miniProgram<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
wx<span class="token punctuation">.</span>miniProgram<span class="token punctuation">.</span><span class="token function">getEnv</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>miniprogram<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>通过公众号（已绑定小程序）首页进入到关联的小程序或通过公众号文章里面添加的小程序链接进入到关联的小程序</p></li></ul> <h4 id="_2-小程序-h5-webview"><a href="#_2-小程序-h5-webview" class="header-anchor">#</a> 2. 小程序 -&gt; H5(webview)</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- wxml --&gt;</span>
<span class="token comment">&lt;!-- 指向微信公众平台首页的web-view --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-view</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://m.xxx.com/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="app-h5-小程序"><a href="#app-h5-小程序" class="header-anchor">#</a> APP-h5-小程序</h3> <p>APP 如果不发起分享到微信，或从 APP 打开小程序时，小程序是不能返回 APP,只有 APP 给小程序导流，小程序才能给 APP 导流。</p> <h4 id="_1-app-分享到微信"><a href="#_1-app-分享到微信" class="header-anchor">#</a> 1. APP 分享到微信</h4> <ul><li><p><a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419317340" target="_blank" rel="noopener noreferrer">andriod-&gt;微信<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419317332" target="_blank" rel="noopener noreferrer">ios-&gt;微信<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="_2-小程序返回-app"><a href="#_2-小程序返回-app" class="header-anchor">#</a> 2. 小程序返回 APP</h4> <p>此功能需要用户主动触发才能打开 APP，所以不由 API 来调用，需要用 open-type 的值设置为 launchApp 的 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/launchApp.html" target="_blank" rel="noopener noreferrer">button<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 组件的点击来触发。
当小程序从 APP 分享消息卡片的场景打开（场景值 1036，APP 分享小程序文档 iOS / Android） 或从 APP 打开的场景打开时（场景值 1069），小程序会获得打开 APP 的能力，此时用户点击按钮可以打开分享该小程序卡片/拉起该小程序的 APP。</p> <p><img src="/assets/img/wx-scene.182b0166.png" alt="scene场景值判断"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalSceneCode
<span class="token comment">// 1036：App分享</span>
<span class="token comment">// 1069：从App打开</span>
<span class="token comment">// 1038：从其他小程序返回小程序</span>
<span class="token comment">// 1089：小程序从聊天顶部场景中的「最近使用」内打开时</span>
<span class="token comment">// 1090：长按小程序右上角菜单唤出最近使用历史打开时</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>scene <span class="token operator">==</span> <span class="token number">1036</span> <span class="token operator">||</span> scene <span class="token operator">==</span> <span class="token number">1069</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  flag <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>scene <span class="token operator">!=</span> <span class="token number">1038</span> <span class="token operator">&amp;&amp;</span> scene <span class="token operator">!=</span> <span class="token number">1089</span> <span class="token operator">&amp;&amp;</span> scene <span class="token operator">!=</span> <span class="token number">1090</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  flag <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token comment">// url = `${url}${url.includes('?') ? '&amp;' : '?'}flag=${flag}`</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>launchApp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">app-parameter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unitId=12345&amp;userId=1234<span class="token punctuation">&quot;</span></span> <span class="token attr-name">binderror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>launchAppError<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>打开APP<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol><li>app 分享打开的是原生页面，根据 flag 是 1 或 0，小程序内是否显示 app 内打开 按钮,</li></ol> <ul><li><p>若分享成功后，微信唤起 App，并传递<code>app-parameter</code>参数到 App，在 App 中添加<code>WXApiDelegate</code>中的<code>onReq</code>方法，处理参数。</p></li> <li><p>如果唤起 App 失败，在 binderror 对应的方法中处理唤起失败后的逻辑：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">launchAppError</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>如果是没有安装 App，可以使用 <code>wx.previewImage</code> 的方法弹出引导关注公众号的图片文案。
<img src="/assets/img/follow.fee09657.gif" alt="关注公众号"></p> <p>都知道从公众号文章或者底部菜单是可以调转到小程序的，从小程序是不可以调转回公众号的。但是在微信小程序中长按 previewImage 打开的图片，是可以识别二维码的，接着直接跳转到公众号。（这个功能不是每次都能实现的）</p></li></ul> <ol start="2"><li>假如 app 分享 h5 页面到微信（小程序向 app 提供两个地址，小程序 webview 地址，要跳转的 h5 地址），小程序通过 webview 进入到 h5 页面，h5 页面通过 url 上获取从 webview 传递过来的 flag 判断是否显示<code>app 内打开</code>按钮,然后跳转到原生页面，点击<code>打开 APP</code>按钮，返回 app</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-view</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h3> <p><a href="/blog/web/evoke.html">h5 打开 app</a></p> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html" target="_blank" rel="noopener noreferrer">微信小程序开发平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/web/evoke.html" class="prev">
        H5 唤起 app
      </a></span> <span class="next"><a href="/blog/node/koa.html">
        koa项目笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.92dc81f6.js" defer></script><script src="/assets/js/2.2d54ebdc.js" defer></script><script src="/assets/js/21.1b255fe0.js" defer></script>
  </body>
</html>
