<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从 0 搭建 rollup + typescript + jest 工具库 | crise&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./assets/logo.png">
    <meta name="description" content="一名程序员/前端人的技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.1cd9ab6a.css" as="style"><link rel="preload" href="/assets/js/app.237e33b5.js" as="script"><link rel="preload" href="/assets/js/2.a6e094ff.js" as="script"><link rel="preload" href="/assets/js/4.9b118658.js" as="script"><link rel="prefetch" href="/assets/js/10.ed6b7b4f.js"><link rel="prefetch" href="/assets/js/11.33a35b98.js"><link rel="prefetch" href="/assets/js/12.545dcf20.js"><link rel="prefetch" href="/assets/js/13.0157a43a.js"><link rel="prefetch" href="/assets/js/14.6926c1c5.js"><link rel="prefetch" href="/assets/js/15.de7aef62.js"><link rel="prefetch" href="/assets/js/16.0b9d8c28.js"><link rel="prefetch" href="/assets/js/17.45f356c9.js"><link rel="prefetch" href="/assets/js/18.5e50c60e.js"><link rel="prefetch" href="/assets/js/19.d739307b.js"><link rel="prefetch" href="/assets/js/20.7d3dc31c.js"><link rel="prefetch" href="/assets/js/21.5f1ef20a.js"><link rel="prefetch" href="/assets/js/22.5864a5a2.js"><link rel="prefetch" href="/assets/js/23.ec78678c.js"><link rel="prefetch" href="/assets/js/24.316a50ac.js"><link rel="prefetch" href="/assets/js/25.e7923a60.js"><link rel="prefetch" href="/assets/js/26.fd02b552.js"><link rel="prefetch" href="/assets/js/27.0003fc19.js"><link rel="prefetch" href="/assets/js/28.fccb544e.js"><link rel="prefetch" href="/assets/js/29.21f2e63a.js"><link rel="prefetch" href="/assets/js/3.f3817cd8.js"><link rel="prefetch" href="/assets/js/30.f706c3a5.js"><link rel="prefetch" href="/assets/js/31.93eb136e.js"><link rel="prefetch" href="/assets/js/32.f1918a14.js"><link rel="prefetch" href="/assets/js/33.633fdfb4.js"><link rel="prefetch" href="/assets/js/34.1f46d635.js"><link rel="prefetch" href="/assets/js/35.a090b183.js"><link rel="prefetch" href="/assets/js/36.ea5de301.js"><link rel="prefetch" href="/assets/js/37.01ed1858.js"><link rel="prefetch" href="/assets/js/38.6c04b42d.js"><link rel="prefetch" href="/assets/js/39.61a2c924.js"><link rel="prefetch" href="/assets/js/40.cd078337.js"><link rel="prefetch" href="/assets/js/41.9d443262.js"><link rel="prefetch" href="/assets/js/42.4b91203f.js"><link rel="prefetch" href="/assets/js/43.415a3857.js"><link rel="prefetch" href="/assets/js/44.b4aaf64d.js"><link rel="prefetch" href="/assets/js/45.0175e1e7.js"><link rel="prefetch" href="/assets/js/46.76ddb299.js"><link rel="prefetch" href="/assets/js/47.24fc1119.js"><link rel="prefetch" href="/assets/js/48.d753a44d.js"><link rel="prefetch" href="/assets/js/49.d4b652dc.js"><link rel="prefetch" href="/assets/js/5.317978c4.js"><link rel="prefetch" href="/assets/js/50.6c2887ad.js"><link rel="prefetch" href="/assets/js/51.3d0febed.js"><link rel="prefetch" href="/assets/js/52.6996c471.js"><link rel="prefetch" href="/assets/js/53.d7277718.js"><link rel="prefetch" href="/assets/js/54.d89f5330.js"><link rel="prefetch" href="/assets/js/55.b3197515.js"><link rel="prefetch" href="/assets/js/56.98cd9448.js"><link rel="prefetch" href="/assets/js/57.ad53dd47.js"><link rel="prefetch" href="/assets/js/58.8c1618f3.js"><link rel="prefetch" href="/assets/js/59.94460e81.js"><link rel="prefetch" href="/assets/js/6.a0219e38.js"><link rel="prefetch" href="/assets/js/60.3b7da87f.js"><link rel="prefetch" href="/assets/js/61.e608e32a.js"><link rel="prefetch" href="/assets/js/62.1e131ad7.js"><link rel="prefetch" href="/assets/js/63.41ea7b98.js"><link rel="prefetch" href="/assets/js/64.4f7fd140.js"><link rel="prefetch" href="/assets/js/65.1c0798b5.js"><link rel="prefetch" href="/assets/js/66.7d7588f6.js"><link rel="prefetch" href="/assets/js/67.739991ea.js"><link rel="prefetch" href="/assets/js/68.f9b883d5.js"><link rel="prefetch" href="/assets/js/69.9edfe956.js"><link rel="prefetch" href="/assets/js/7.99a9934c.js"><link rel="prefetch" href="/assets/js/70.db60f31a.js"><link rel="prefetch" href="/assets/js/71.00b04458.js"><link rel="prefetch" href="/assets/js/72.5ee17ade.js"><link rel="prefetch" href="/assets/js/73.24fde59b.js"><link rel="prefetch" href="/assets/js/74.7d870932.js"><link rel="prefetch" href="/assets/js/75.75f6627d.js"><link rel="prefetch" href="/assets/js/76.ce1ead80.js"><link rel="prefetch" href="/assets/js/77.208f1a5c.js"><link rel="prefetch" href="/assets/js/8.9f6f4f79.js"><link rel="prefetch" href="/assets/js/9.abcfea03.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1cd9ab6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">crise's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineer/ui-fit.html" class="sidebar-link">移动端UI适配方案选择</a></li><li><a href="/blog/engineer/cli.html" class="sidebar-link">从 0 打造属于自己的脚手架</a></li><li><a href="/blog/engineer/vue3-template.html" class="sidebar-link">从 0 搭建 vue3+vite+typescript 企业级项目</a></li><li><a href="/blog/engineer/library-template.html" aria-current="page" class="active sidebar-link">从 0 搭建 rollup + typescript + jest 工具库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#实现的功能" class="sidebar-link">实现的功能</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#模板依赖版本" class="sidebar-link">模板依赖版本</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#初始化项目" class="sidebar-link">初始化项目</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#配置typescript" class="sidebar-link">配置Typescript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#安装依赖" class="sidebar-link">安装依赖</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#增加配置" class="sidebar-link">增加配置</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#配置tsconfig-json" class="sidebar-link">配置tsconfig.json</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#集成eslint" class="sidebar-link">集成eslint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#配置-eslintrc-js" class="sidebar-link">配置 .eslintrc.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#集成-prettier-不需要就跳过" class="sidebar-link">集成 prettier（不需要就跳过）</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#使用rollup" class="sidebar-link">使用rollup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#为什么不使用webpack" class="sidebar-link">为什么不使用webpack？</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#rollup插件" class="sidebar-link">rollup插件</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#配置rollup-config-ts文件" class="sidebar-link">配置rollup.config.ts文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#集成-husky-lint-staged" class="sidebar-link">集成 husky + lint-staged</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#代码提交规范统一" class="sidebar-link">代码提交规范统一</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#集成-commitizen-实现提交规范" class="sidebar-link">集成 Commitizen 实现提交规范</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#集成-commitlint-验证提交规范" class="sidebar-link">集成 commitlint 验证提交规范</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#单元测试" class="sidebar-link">单元测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#安装依赖-2" class="sidebar-link">安装依赖</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#配置jest-config-js文件" class="sidebar-link">配置jest.config.js文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/library-template.html#写在最后" class="sidebar-link">写在最后</a></li></ul></li><li><a href="/blog/engineer/eslintrc.html" class="sidebar-link">ESLint使用、原理及配置规则详解</a></li><li><a href="/blog/engineer/vue2-vue3.html" class="sidebar-link">Vue2 与 Vue3 的区别</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ts系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineer/tsconfig.html" class="sidebar-link">tsconfig.json配置详解</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>babel系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineer/babel.html" class="sidebar-link">babel</a></li><li><a href="/blog/engineer/babel-plugin.html" class="sidebar-link">babel常用插件</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>web跨端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架及原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从-0-搭建-rollup-typescript-jest-工具库"><a href="#从-0-搭建-rollup-typescript-jest-工具库" class="header-anchor">#</a> 从 0 搭建 rollup + typescript + jest 工具库</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>公司不同项目之间由于业务的关联性，总是会沉淀许多通用的工具方法以及业务功能，我们可以搭建一个工具库来给各个项目使用。看了本文，你能知道怎么搭建一个统一的工具库，并且学会在工具库中使用rollup打包工具配置babel、ts、commonjs等功能插件（本文是<a href="/blog/engineer/vue3_template.html">从 0 搭建 vue3+vite+typescript 企业级项目</a>的姊妹篇）。</p> <h2 id="实现的功能"><a href="#实现的功能" class="header-anchor">#</a> 实现的功能</h2> <ul><li>ts代码检验</li> <li>单元测试及覆盖率检测</li> <li>打包成umd、cmd、esm格式代码</li> <li>兼容传统浏览器，并按需加载polyfill</li> <li>编辑器的快速补全和提示</li> <li>自动生成 changlog</li> <li>约束编码风格、保存格式化</li> <li>代码提交强制校验</li></ul> <h2 id="模板依赖版本"><a href="#模板依赖版本" class="header-anchor">#</a> 模板依赖版本</h2> <ul><li><code>node：&gt;=v12.0.0</code></li> <li><code>rollup：^2.55.0</code></li> <li><code>@rollup/plugin-babel：^5.3.0</code></li> <li><code>@rollup/plugin-commonjs：^19.0.2</code></li> <li><code>@rollup/plugin-json：^4.1.0</code></li> <li><code>@rollup/plugin-node-resolve：^13.0.4</code></li> <li><code>rollup-plugin-terser：^7.0.2</code></li> <li><code>rollup-plugin-dts：^4.2.2</code></li> <li><code>typescript：^4.6.4</code></li> <li><code>@typescript-eslint/eslint-plugin：^5.13.0</code></li> <li><code>@typescript-eslint/parser：^5.13.0</code></li> <li><code>@babel/core：^7.14.8</code></li> <li><code>@babel/preset-env：^7.14.8</code></li> <li><code>@babel/plugin-transform-runtime：^7.17.0</code></li> <li><code>@babel/preset-typescript：^7.18.6</code></li> <li><code>babel-plugin-polyfill-corejs3：^0.5.2</code></li> <li><code>prettier：^2.5.1</code></li> <li><code>eslint：^8.10.0</code></li> <li><code>eslint-config-airbnb-base: ^15.0.0</code></li> <li><code>eslint-plugin-import：^2.25.4</code></li> <li><code>eslint-import-resolver-alias：^1.1.2</code></li> <li><code>eslint-config-prettier：^8.5.0</code></li> <li><code>eslint-plugin-prettier：^4.0.0</code></li> <li><code>jest：^28.1.0</code></li> <li><code>ts-jest：^28.0.8</code></li> <li><code>@types/jest：^27.5.0</code></li> <li><code>@jest/globals：^28.0.3</code></li></ul> <h2 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h2> <p>新建一个项目目录如 utils , 并 npm init -y 初始化项目。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> utils <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> utils
<span class="token function">npm</span> init -y
</code></pre></div><h2 id="配置typescript"><a href="#配置typescript" class="header-anchor">#</a> 配置Typescript</h2> <h3 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> <span class="token function">install</span> typescript
</code></pre></div><p>创建 <code>types</code> 目录作为类型声明文件管理目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code>utils
 <span class="token operator">|</span>
 <span class="token operator">|</span>- src
 	 <span class="token operator">|</span>- global.d.ts
 <span class="token operator">|</span>- tsconfig.json
</code></pre></div><h3 id="增加配置"><a href="#增加配置" class="header-anchor">#</a> 增加配置</h3> <p>在项目根目录新增<code>.vscode</code>文件夹，在下新增<code>settings.json</code>文件。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;typescript.tsdk&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./node_modules/typescript/lib&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新增这行配置。意义是项目中vscode使用的ts的sdk路径是我们依赖中的ts，不是vscode内置的ts版本！保证团队使用的都是同一个<code>ts sdk</code>。</p> <h3 id="配置tsconfig-json"><a href="#配置tsconfig-json" class="header-anchor">#</a> 配置tsconfig.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">/* 基础配置 */</span>
    <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 编译过程中需要引入的库文件的列表</span>
        <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 编译后的目标版本</span>
        <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 编译后代码遵循的规范</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 启用它会阻止Typescript对导入的库进行类型检查</span>
        <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

        <span class="token comment">/* 强类型检查配置 */</span>
        <span class="token comment">// 严格模式, 强烈建议开启，如果不开启，TS就没有意义了</span>
        <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定 jsx 代码的生成: 'preserve', 'react-native', or 'react'</span>
        <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 必须标注为null类型,才可以赋值为null</span>
        <span class="token property">&quot;strictNullChecks&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// true：在表达式和声明上有隐含的 any类型时报错</span>
        <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// 为 true，允许从没有设置默认导出的模块中默认导入。这并不影响代码的显示，仅为了类型检查。</span>
        <span class="token property">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 用来指定是否允许编译JS文件，默认false,即不编译JS文件</span>
        <span class="token comment">// &quot;allowJs&quot;: true,</span>
        <span class="token comment">// 当this表达式的值为any类型的时候，生成一个错误</span>
        <span class="token property">&quot;noImplicitThis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

        <span class="token comment">/* 模块分析配置 */</span>
        <span class="token comment">// 此处设置为node,才能解析import xx from 'xx'</span>
        <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 允许我们在 TypeScript 模块中导入 JSON 文件</span>
        <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 兼容模式：将 CommonJS文件 的所有导出合并作为一个 default export，支持使用import XX from 'XX'语法导入 CommonJS 模块。辅助解决ES模块中引入CommonJs模块时的问题，主要针对ESM中有默认导出而CommonJs没有。</span>
        <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 配置类型声明文件`d.ts`的查找路径。默认在node_modules下的@types里面查找。</span>
        <span class="token property">&quot;typeRoots&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./node_modules/@types/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./types/&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/**/*.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./types/*.d.ts&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;docs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;coverage&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="集成eslint"><a href="#集成eslint" class="header-anchor">#</a> 集成eslint</h2> <p>TypeScirpt 从2019年开始便已全面采用<code>ESLint</code>作为代码检测工具。并且提供了 TypeScript 文件的解析器 <a href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/parser" target="_blank" rel="noopener noreferrer">@typescript-eslint/parser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 选项配置插件 <a href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin" target="_blank" rel="noopener noreferrer">@typescript-eslint/eslint-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>详细描述可以查看 <a href="https://eslint.org/blog/2019/01/future-typescript-eslint/" target="_blank" rel="noopener noreferrer">the future of TypeScript on ESLint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin -D
<span class="token comment"># pnpm i eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-plugin-import eslint-import-resolver-typescript -D</span>
</code></pre></div><h3 id="配置-eslintrc-js"><a href="#配置-eslintrc-js" class="header-anchor">#</a> 配置 .eslintrc.js</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">es6</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token string">'latest'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@typescript-eslint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'eslint:recommended'</span><span class="token punctuation">,</span>
        <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'import/prefer-default-export'</span><span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'global-require'</span><span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'import/export'</span><span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'@typescript-eslint/ban-ts-comment'</span><span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">system</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// parserOptions: {</span>
    <span class="token comment">//   project: './tsconfig.json',</span>
    <span class="token comment">// },</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>如需了解eslint原理及具体配置规则，请点击<a href="/blog/engineer/eslintrc.html">ESLint使用、原理及配置规则详解</a></p> <h2 id="集成-prettier-不需要就跳过"><a href="#集成-prettier-不需要就跳过" class="header-anchor">#</a> 集成 prettier（不需要就跳过）</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li><code>prettier</code>主要负责: 风格检查, 没有质量检查。虽然 eslint 本身只提供了部分风格检查，但是这导致有部分的代码依然没有实现风格检查，具体细节下面会说。对于大多数实际项目，都会使用<code>prettier</code>进行风格检查。由于会出现引入多个风格检查的插件和配置 lint，这就导致存在部分会与 prettier 的 lint 出现冲突，因此需要 lint 预设包。</li> <li><code>eslint-config-prettier</code>，这个包的作用是先关闭这些与 prettier 冲突的 lint 规则，然后之后再启用 prettier 的规则，使得冲突的 lint 规则以 prettier 为准。</li> <li><code>eslint-plugin-prettier</code>插件会调用<code>prettier</code>对你的代码风格进行检查，其原理是先使用 prettier 对你的代码进行格式化，然后与格式化之前的代码进行对比，如果过出现了不一致，这个地方就会被 prettier 进行标记。</li></ol></div> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i prettier eslint-config-prettier eslint-plugin-prettier -D
</code></pre></div><ol start="2"><li>创建配置文件： <code>prettier.config.js</code> 或 <code>.prettierrc.js</code> 或 <code>.prettierrc</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 一行最多 80 字符</span>
  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用 4 个空格缩进</span>
  <span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token comment">// 不使用 tab 缩进，而使用空格</span>
  <span class="token literal-property property">useTabs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 行尾需要有分号</span>
  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用单引号代替双引号</span>
  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 对象的 key 仅在必要时用引号</span>
  <span class="token literal-property property">quoteProps</span><span class="token operator">:</span> <span class="token string">&quot;as-needed&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// jsx 不使用单引号，而使用双引号</span>
  <span class="token literal-property property">jsxSingleQuote</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 末尾使用逗号</span>
  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 大括号内的首尾需要空格 { foo: bar }</span>
  <span class="token literal-property property">bracketSpacing</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// jsx 标签的反尖括号需要换行</span>
  <span class="token literal-property property">jsxBracketSameLine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 箭头函数，只有一个参数的时候，也需要括号</span>
  <span class="token literal-property property">arrowParens</span><span class="token operator">:</span> <span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 每个文件格式化的范围是文件的全部内容</span>
  <span class="token literal-property property">rangeStart</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rangeEnd</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否需要写文件开头的 @prettier</span>
  <span class="token literal-property property">requirePragma</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否自动在文件开头插入 @prettier</span>
  <span class="token literal-property property">insertPragma</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用默认的折行标准</span>
  <span class="token literal-property property">proseWrap</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 根据显示样式决定 html 要不要折行</span>
  <span class="token literal-property property">htmlWhitespaceSensitivity</span><span class="token operator">:</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 换行符使用 lf</span>
  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">&quot;lf&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>修改 <code>.eslintrc.js</code> 配置</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>
      <span class="token string">'prettier'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token operator">...</span>
        <span class="token string">'prettier'</span><span class="token punctuation">,</span>
        <span class="token string">'plugin:prettier/recommended'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <p>更多配置，可以查看<a href="https://prettier.io/docs/en/options.html#print-width" target="_blank" rel="noopener noreferrer">Prettier Options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
在设置中，搜索 <code>save</code> ，勾选 <code>Format On Save</code>：
<img src="/assets/img/save.afaab03c.png" alt="format on save">
然后在 <code>.vscode文件夹</code>下的 <code>setting.json</code> 中增加配置：</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;source.fixAll&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[javascript]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbaeumer.vscode-eslint&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[typescript]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbaeumer.vscode-eslint&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
</code></pre></div><p>指定默认格式化工具很重要。即使你的eslint以及其他配置项都对，但是保存的时候代码闪来闪去那说明你的默认格式化工具不正确。</p> <h2 id="使用rollup"><a href="#使用rollup" class="header-anchor">#</a> 使用rollup</h2> <h3 id="为什么不使用webpack"><a href="#为什么不使用webpack" class="header-anchor">#</a> 为什么不使用webpack？</h3> <p>一说到打包工具大家都想到webpack，因为我们用到的vue，react脚手架都是基于webpack的。webpack 的一个理念是“万物皆是模块”，在此理念下，他有各种loader，能够帮助我们处理各类资源，这针对于开发构建 <code>web应用</code> 是很有效的，<code>5.x</code>版本 引入的<a href="https://webpack.docschina.org/concepts/module-federation" target="_blank" rel="noopener noreferrer">模块联邦<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>更是奠基了<code>微应用</code>时代的霸主地位。但是他生成代码有很多不是我们所写的逻辑代码，比如一些他自有的模块加载功能:
<img src="https://img-blog.csdnimg.cn/img_convert/62b1963191e66e3e5b4c33ff73570c7a.png" alt="webpack模块代码">
如果你要开发js库，那webpack的繁琐和打包后的文件体积就不太适用了。有需求就有工具，所以rollup的产生就是针对开发js库的。</p> <p><a href="https://rollupjs.org/guide/en/" target="_blank" rel="noopener noreferrer">rollup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一个“JavaScript模块打包器”，致力于将小块的代码编译成大的复杂的代码。相比于 webpack，rollup.js的优势在于：</p> <ul><li>api 简单，学习成本低。</li> <li>因为专注构建出的代码体积更小。（构建结果就是纯纯的 js，并不会被 <code>__webpack_require__</code> 之类的代码增加代码量）</li> <li>vue/react/angular等许多流行库都在用他作为打包工具，热门工具 <code>vite</code> 采用了它当生产构建工具。（最近各大厂都在纷纷试水 <code>vite</code> 落地，不能不说是个机会吧？）</li> <li>如果需要，他可以同时帮我们生成支持 <code>umd/commonjs/es</code>的js代码</li></ul> <h3 id="rollup插件"><a href="#rollup插件" class="header-anchor">#</a> rollup插件</h3> <p>我们需要对rollup添加一些自定义的配置，以扩展rollup能力。</p> <ul><li>将 CommonJS 模块转换为 ES6</li> <li>使用<code>node 解析算法</code>解析<code>esm</code>路径名</li> <li>集成babel，将代码转译成es5代码，以适应传统浏览器</li> <li>对<code>esm</code>路径名使用alias别名</li> <li>自动导出ts类型声明文件</li></ul> <h4 id="rollup-plugin-commonjs插件"><a href="#rollup-plugin-commonjs插件" class="header-anchor">#</a> @rollup/plugin-commonjs插件</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>官方文档简介：将 CommonJS 模块转换为 ES6，这样它们就可以包含在 Rollup 包中。</p></div> <p>我给翻译下：<strong>rollup.js 默认支持的是 esm 格式的模块化，但有了它，你就能在项目里导入 commonjs 格式的文件/模块。</strong>。</p> <p>举个🌰：</p> <p>有两个文件，分别是 <code>index.js</code> 和 <code>utils.js</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// utils.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token number">42</span>
</code></pre></div><p><code>utils.js</code> 的导出模式 <code>module.exports</code> 是 <code>commonjs</code> 格式的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">&quot;./utils&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">printUtils</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">the utils is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>utils<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当我们没有使用插件，直接拿rollup进行打包时，控制台会直接报错：
<code>Error: 'default' is not exported by utils.js</code></p> <p>也就是说：<code>utils.js</code> 所使用的 <code>commonjs</code> 的导出方式，决定了它无法被普通js正常import。因此，我们需要<code>@rollup/plugin-commonjs</code>插件来导入commonjs格式的文件/模块。
引入之后，然后打包：
<img src="/assets/img/commonjs-result.bde6dce1.png" alt="commonjs输出">
commonjs格式的文件，便被正常打包到输出文件中。</p> <h4 id="rollup-plugin-node-resolve插件"><a href="#rollup-plugin-node-resolve插件" class="header-anchor">#</a> @rollup/plugin-node-resolve插件</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>官方文档简介：使用 <a href="http://nodejs.cn/api/modules.html#all-together" target="_blank" rel="noopener noreferrer">node 解析算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来定位模块，用于使用 node_modules 中的第三方模块。</p></div> <p>rollup.js 默认的文件定位方式属于 <code>esm</code>，不能直接解析<code>ts</code>后缀名文件。</p> <p>举个🌰：</p> <p>比如：<code>src/index.ts</code>目录下引用了<code>utils.ts</code>文件。</p> <p>当我们没有使用插件，直接拿rollup进行打包时，控制台会直接报错：
<code>Error: Could not resolve './environment' from src/index.ts</code>。</p> <p>在 <code>@rollup/plugin-node-resolve</code> 插件的帮助下，才能成功命中 'src/environment.ts' 文件。</p> <h4 id="rollup-plugin-babel插件"><a href="#rollup-plugin-babel插件" class="header-anchor">#</a> @rollup/plugin-babel插件</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>官方文档简介：一个 Rollup 插件，用于 Rollup 和 Babel 之间的无缝集成。</p></div> <p>熟悉 Babel 的同学应该很容易明白它的用途，使用本插件，可以通过 Babel 的能力将你所写的 es6/es7 代码编译转换为 es5 的，以适用传统浏览器。</p> <p>举个🌰：</p> <p>比如：<code>src/index.js</code>编写如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">seconds</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> seconds<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">printUtils</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I am awake...'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>不使用插件打包出来的代码：基本没有变化，还是有 async 和 await。</li> <li>使用插件打包出来的代码：没有 await 和 async 了，编译成了兼容性更强的代码。</li></ul> <h4 id="rollup-plugin-alias插件"><a href="#rollup-plugin-alias插件" class="header-anchor">#</a> @rollup/plugin-alias插件</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>官方文档简介：一个在构件包时定义“别名”的 Rollup 插件。</p></div> <p>翻译成人话也就是：使用这个插件，你可以在引入文件时，使用一个 <code>别名</code> 来代替原有的那些固定的路径。</p> <p>举个🌰：</p> <p>比如：<code>src/index.js</code>编写如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">&quot;@/utils&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">printUtils</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">utils is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>utils<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>不使用插件打包之后的产物中<code>@/utils</code>没有解析到对应的文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">&quot;@/utils&quot;</span>

<span class="token keyword">const</span> <span class="token function-variable function">printUtils</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">answer is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> printUtils <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用插件打包之后，<code>@/utils</code>能够解析</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">printUtils</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">answer is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>utils<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> printUtils <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="rollup-plugin-dts插件"><a href="#rollup-plugin-dts插件" class="header-anchor">#</a> rollup-plugin-dts插件</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>官方文档简介：一个可以自动导出 <code>.d.ts</code> 的 Rollup 插件。</p></div> <p>ps：该插件会自动将任何外部库（@types例如）标记为external，因此这些库将被排除在捆绑之外</p> <h3 id="配置rollup-config-ts文件"><a href="#配置rollup-config-ts文件" class="header-anchor">#</a> 配置rollup.config.ts文件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> nodeResolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> dts <span class="token keyword">from</span> <span class="token string">'rollup-plugin-dts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> json <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-json'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-babel'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        input<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'UTILS'</span><span class="token punctuation">,</span>
            file<span class="token operator">:</span> <span class="token string">'dist/index.umd.js'</span><span class="token punctuation">,</span>
            format<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                babelrc<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                babelHelpers<span class="token operator">:</span> <span class="token string">'runtime'</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span><span class="token punctuation">,</span>
                extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        input<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                file<span class="token operator">:</span> <span class="token string">'dist/index.cjs.js'</span><span class="token punctuation">,</span>
                format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                file<span class="token operator">:</span> <span class="token string">'dist/index.esm.js'</span><span class="token punctuation">,</span>
                format<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                modulesOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                babelrc<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                babelHelpers<span class="token operator">:</span> <span class="token string">'runtime'</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span><span class="token punctuation">,</span>
                extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        input<span class="token operator">:</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> file<span class="token operator">:</span> <span class="token string">'dist/index.d.ts'</span><span class="token punctuation">,</span> format<span class="token operator">:</span> <span class="token string">'es'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">dts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="集成-husky-lint-staged"><a href="#集成-husky-lint-staged" class="header-anchor">#</a> 集成 husky + lint-staged</h2> <ol><li>安装 husky</li></ol> <p><code>husky</code> 是一个为 git 客户端增加 <code>hook</code> 的工具。安装后，它会自动在仓库中的 <code>.git/</code> 目录下增加相应的钩子；比如 <code>pre-commit</code> 钩子就会在你执行 <code>git commit</code> 的触发。</p> <p>那么我们可以在 <code>pre-commit</code> 中实现一些比如 <code>lint 检查</code>、<code>单元测试</code>、<code>代码美化</code>等操作。当然，<code>pre-commit</code> 阶段执行的命令当然要保证其速度不要太慢，每次 commit 都等很久也不是什么好的体验。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx husky-init <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><p>这行命令做了四件事：</p> <ul><li>安装 husky 到开发依赖</li> <li>在项目根目录下创建 .husky 目录</li> <li>在 .husky 目录创建 pre-commit hook，并初始化 pre-commit 命令为 npm test</li> <li>修改 package.json 的 scripts，增加 &quot;prepare&quot;: &quot;husky install&quot;</li></ul> <p>安装成功后会发现项目中多了一个<code>.husky</code>文件夹:
<img src="/assets/img/husky.0551ac8e.png" alt="husky"></p> <p>到这里，husky 配置完毕，现在我们来使用它：</p> <p>husky 包含很多 <code>hook</code>（钩子），常用有：<code>pre-commit</code>、<code>commit-msg</code>、<code>pre-push</code>。这里，我们使用 pre-commit 来触发 ESLint 命令。</p> <p>修改 .husky/pre-commit hook 文件的触发命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>eslint --fix ./src --ext .vue,.js,.ts
</code></pre></div><p>上面这个 <code>pre-commit</code> hook 文件的作用是：</p> <p>当我们执行 <code>git commit -m &quot;xxx&quot;</code> 时，会先对 src 目录下所有的 .vue、.js、.ts  文件执行 eslint --fix 命令，如果 ESLint 通过，成功 commit，否则终止 commit。</p> <p>但是又存在一个问题：有时候我们明明只改动了一两个文件，却要对所有的文件执行 eslint --fix。</p> <p>假如这是一个历史项目，我们在中途配置了<code>ESLint</code>规则，那么在提交代码时，也会对其他未修改的“历史”文件都进行检查，可能会造成大量文件出现 <code>ESLint</code>错误，显然不是我们想要的结果。
我们要做到只用<code>ESLint</code>修复自己此次写的代码，而不去影响其他的代码。所以我们还需借助一个神奇的工具<code>lint-staged</code>。</p> <ol start="2"><li>配置lint-staged</li></ol> <p><code>lint-staged</code> 这个工具一般结合 husky 来使用，它可以让 husky 的 hook 触发的命令只作用于 git add那些文件（即 git 暂存区的文件），而不会影响到其他文件。</p> <p>接下来，我们使用 lint-staged 继续优化项目。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i lint-staged -D
</code></pre></div><p>在 <code>package.json</code> 里增加 lint-staged 配置项</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;*.{js,ts,vue}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;eslint --cache --fix&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">&quot;*.{vue,less}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;stylelint --fix  --custom-syntax postcss-less&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这行命令表示：只对 <code>git 暂存区</code>的 <code>.vue、.js、.ts</code> 文件执行 <code>eslint --fix</code>。</p> <ol start="3"><li>修改 <code>.husky/pre-commit</code> hook 的触发命令为：<code>npx lint-staged</code> <img src="/assets/img/husky.0551ac8e.png" alt="husky"></li></ol> <p>至此，<code>husky</code> 和 <code>lint-staged</code> 组合配置完成。</p> <p>现在我们提交代码时就会变成这样：</p> <p>假如我们修改了 src 目录下的 <code>user.vue</code> 以及 根目录下的 <code>vite.config.ts</code> 文件，然后 <code>git add ./src/</code>，最后 <code>git commit -m &quot;test...&quot;</code>，这时候就会只对 <code>user.vue</code> 这两个文件执行 <code>eslint --fix</code> 和 <code>stylelint --fix</code>。如果 ESLint 和 stylelint通过，成功提交，否则终止提交。从而保证了我们提交到 Git 仓库的代码都是规范的。</p> <h2 id="代码提交规范统一"><a href="#代码提交规范统一" class="header-anchor">#</a> 代码提交规范统一</h2> <blockquote><p>为了使团队多人协作更加的规范，所以需要每次在 git 提交的时候，做一次硬性规范提交，规范 git 的提交信息。</p></blockquote> <p>如果 git commit 的描述信息精准，在后期维护和 Bug 处理时会变得有据可查，项目开发周期内还可以根据规范的提交信息快速生成开发日志，从而方便我们追踪项目和把控进度。</p> <p>这里，我们使用社区最流行、最知名、最受认可的 <a href="https://github.com/angular/angular/commits/master" target="_blank" rel="noopener noreferrer">Angular 团队提交规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="集成-commitizen-实现提交规范"><a href="#集成-commitizen-实现提交规范" class="header-anchor">#</a> 集成 <a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener noreferrer">Commitizen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现提交规范</h3> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i -D commitizen cz-customizable
</code></pre></div><ol start="2"><li>配置<code>package.json</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;commit&quot;</span><span class="token operator">:</span><span class="token string">&quot;cz&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/cz-customizable&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div></details> <ol start="3"><li>自定义提示则添加 <code>.cz-config.js</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可选类型</span>
  <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'feat'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'feat:     新功能'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'fix:      修复'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'docs:     文档变更'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'style:    代码风格相关(不影响代码运行的变动)'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'refactor'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'refactor: 重构(既不是增加feature，也不是修复bug)'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'perf'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'perf:     性能优化'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test:     测试相关'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'chore'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'chore:    依赖更新/脚手架配置修改等'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'revert'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'revert:   撤销修改'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'workflow'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'workflow:    工作流改进'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'ci'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ci:    持续集成'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'types'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'types:    类型定义文件更改'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'wip'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wip:    开发中'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息步骤</span>
  <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'请选择提交类型:'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">customScope</span><span class="token operator">:</span> <span class="token string">'请输入修改范围(可选):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'请简要描述提交(必填):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">'请输入详细描述(可选):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">footer</span><span class="token operator">:</span> <span class="token string">'请输入要关闭的issue(可选):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">confirmCommit</span><span class="token operator">:</span> <span class="token string">'确认使用以上信息提交？(y/n/e/h)'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 跳过问题</span>
  <span class="token literal-property property">skipQuestions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">'footer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// subject文字长度默认是72</span>
  <span class="token literal-property property">subjectLimit</span><span class="token operator">:</span> <span class="token number">72</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="4"><li>交互界面测试</li></ol> <details class="custom-block details"><summary>点击查看图片</summary> <p><img src="/assets/img/cz.f1e46ba6.png" alt="commitizen"></p></details> <h3 id="集成-commitlint-验证提交规范"><a href="#集成-commitlint-验证提交规范" class="header-anchor">#</a> 集成 commitlint 验证提交规范</h3> <p>在“代码规范”章节，我们已经讲到过，尽管制定了规范，但在多人协作的项目中，总有些人依旧我行我素，因此提交代码这个环节，我们也增加一个限制：只让符合规范的 commit message 通过，我们借助 <code>@commitlint/config-conventional</code> 和 <code>@commitlint/cli</code> 来实现。</p> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i @commitlint/config-conventional @commitlint/cli -D
</code></pre></div><ol start="2"><li>新增配置 <code>commitlint.config.js</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@commitlint/config-conventional'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>使用 husky 的 <code>commit-msg</code> hook 触发验证提交信息的命令</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>npx husky <span class="token function">add</span> .husky/commit-msg <span class="token string">&quot;npx --no-install commitlint --edit <span class="token variable">$1</span>&quot;</span>
</code></pre></div><p>使用 husky 命令在 <code>.husky</code> 目录下创建 <code>commit-msg</code> 文件，并在此执行 <code>commit message</code> 的验证命令。
<img src="/assets/img/commitlint.d000feec.png" alt="commitlint">
4. <code>commitlint</code> 验证</p> <ul><li>不符合规范的提交信息
如下图，提交信息 <code>test commitlint</code> 不符合规范，提交失败。
<img src="/assets/img/test_commitlint.63c34a4b.png" alt="test commitlint"></li> <li>符合规范的提交信息
提交信息 <code>chore: commitlint test</code> 符合规范，成功提交到仓库。</li></ul> <h2 id="单元测试"><a href="#单元测试" class="header-anchor">#</a> 单元测试</h2> <blockquote><p>单元测试允许你将独立单元的代码进行隔离测试，完整的测试能为代码和业务提供质量保证，减少 Bug 的出现。通过编写细致且有意义的测试，你能够有信心在构建新特性或重构已有代码的同时，保持应用的功能和稳定。</p></blockquote> <h3 id="安装依赖-2"><a href="#安装依赖-2" class="header-anchor">#</a> 安装依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i jest ts-jest @types/jest @jest/globals -D
</code></pre></div><h3 id="配置jest-config-js文件"><a href="#配置jest-config-js文件" class="header-anchor">#</a> 配置<code>jest.config.js</code>文件</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">preset</span><span class="token operator">:</span> <span class="token string">'ts-jest'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'^.+.ts$'</span><span class="token operator">:</span> <span class="token string">'ts-jest'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">extensionsToTreatAsEsm</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// testEnvironment: 'jsdom',</span>
    <span class="token literal-property property">modulePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;rootDir&gt;/src'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">collectCoverage</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">coverageDirectory</span><span class="token operator">:</span> <span class="token string">'coverage'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'ts-jest'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">useESM</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">tsconfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">allowJs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>执行单元测试</li></ol> <p>在根目录下 <code>package.json</code> 文件的 scripts 中，添加一条单元测试命令： &quot;test:unit&quot;: &quot;jest&quot;。
执行命令 <code>npm run test:unit</code> 即可进行单元测试，jest 会根据 <code>jest.config.js</code> 配置文件去查找 <strong>tests</strong> 目录下的 .ts 文件或其他任意目录下的 .spec.ts 和 .test.ts 文件，然后执行单元测试方法。</p> <blockquote><p>你可以在 <code>jest.config.js</code> 配置文件中，自由配置单元测试文件的目录。</p></blockquote> <ul><li>单元测试全部通过时的终端显示信息
<img src="/assets/img/jest.92dd7e35.png" alt="jest"></li> <li>单元测试未全部通过时的终端显示信息
<img src="/assets/img/jest_fail.8444e923.png" alt="jest_fail">
当单元测试没有全部通过时，我们需要根据报错信息去优化对应组件的代码，进一步提高项目健壮性。但是写单元测试是件比较痛苦的事，我个人觉得也没必要全部组件都写单元测试，根据项目实际情况有针对性去写就行了。</li></ul> <ol start="4"><li>单元测试约束</li></ol> <p>前面，我们使用 <code>husky</code> 在 Git 的 <code>pre-commit</code> 和 <code>commit-msg</code> 阶段分别约束代码风格规范和提交信息规范。这一步，我们在 <code>pre-push</code> 阶段进行单元测试，只有单元测试全部通过才让代码 push 到远端仓库，否则终止 push。</p> <p>使用 husky 命令在 <code>.husky</code> 目录下自动创建 <code>pre-push</code> hook 文件，并在此执行单元测试命令 <code>npm run test:unit</code>。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx husky <span class="token function">add</span> .husky/pre-push <span class="token string">&quot;npm run test:unit <span class="token variable">$1</span>&quot;</span>
</code></pre></div><p>现在，我们在 git push 时就能先进行单元测试了，只有单元测试全部通过，才能成功 push。</p> <h2 id="写在最后"><a href="#写在最后" class="header-anchor">#</a> 写在最后</h2> <blockquote><p><code>公众号</code>：<code>前端开发爱好者</code> 专注分享 <code>web</code> 前端相关<code>技术文章</code>、<code>视频教程</code>资源、热点资讯等，如果喜欢我的分享，给 🐟🐟 点一个<code>赞</code> 👍 或者 ➕<code>关注</code> 都是对我最大的支持。</p></blockquote> <p>欢迎<code>长按图片加好友</code>，我会第一时间和你分享<code>前端行业趋势</code>，<code>面试资源</code>，<code>学习途径</code>等等。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/engineer/vue3-template.html" class="prev">
        从 0 搭建 vue3+vite+typescript 企业级项目
      </a></span> <span class="next"><a href="/blog/engineer/eslintrc.html">
        ESLint使用、原理及配置规则详解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.237e33b5.js" defer></script><script src="/assets/js/2.a6e094ff.js" defer></script><script src="/assets/js/4.9b118658.js" defer></script>
  </body>
</html>
