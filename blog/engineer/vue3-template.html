<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从 0 搭建 vue3+vite+typescript 企业级项目 | crise&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./assets/logo.png">
    <meta name="description" content="一名程序员/前端人的技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.567624d3.css" as="style"><link rel="preload" href="/assets/js/app.92dc81f6.js" as="script"><link rel="preload" href="/assets/js/2.2d54ebdc.js" as="script"><link rel="preload" href="/assets/js/5.1898d05c.js" as="script"><link rel="prefetch" href="/assets/js/10.01084cac.js"><link rel="prefetch" href="/assets/js/11.bac0121f.js"><link rel="prefetch" href="/assets/js/12.4e876679.js"><link rel="prefetch" href="/assets/js/13.d3fce123.js"><link rel="prefetch" href="/assets/js/14.75510bd2.js"><link rel="prefetch" href="/assets/js/15.48750021.js"><link rel="prefetch" href="/assets/js/16.7952a809.js"><link rel="prefetch" href="/assets/js/17.10b72fbd.js"><link rel="prefetch" href="/assets/js/18.13c83f7d.js"><link rel="prefetch" href="/assets/js/19.31948ab8.js"><link rel="prefetch" href="/assets/js/20.dc4c0c1c.js"><link rel="prefetch" href="/assets/js/21.1b255fe0.js"><link rel="prefetch" href="/assets/js/22.2f1d66a8.js"><link rel="prefetch" href="/assets/js/23.cf0fa840.js"><link rel="prefetch" href="/assets/js/24.9cf68851.js"><link rel="prefetch" href="/assets/js/25.c501abdb.js"><link rel="prefetch" href="/assets/js/26.5f6dd563.js"><link rel="prefetch" href="/assets/js/27.74260c5a.js"><link rel="prefetch" href="/assets/js/28.ce8f13bc.js"><link rel="prefetch" href="/assets/js/29.06bdce57.js"><link rel="prefetch" href="/assets/js/3.e9d5348e.js"><link rel="prefetch" href="/assets/js/30.8204335f.js"><link rel="prefetch" href="/assets/js/31.01971e34.js"><link rel="prefetch" href="/assets/js/32.c9d7df95.js"><link rel="prefetch" href="/assets/js/33.96b6de7c.js"><link rel="prefetch" href="/assets/js/34.b813165e.js"><link rel="prefetch" href="/assets/js/35.615aded7.js"><link rel="prefetch" href="/assets/js/36.9c619b20.js"><link rel="prefetch" href="/assets/js/37.90ffb782.js"><link rel="prefetch" href="/assets/js/38.1967fbbd.js"><link rel="prefetch" href="/assets/js/39.0d735efe.js"><link rel="prefetch" href="/assets/js/4.ca421095.js"><link rel="prefetch" href="/assets/js/40.923e5594.js"><link rel="prefetch" href="/assets/js/41.fd7797b4.js"><link rel="prefetch" href="/assets/js/42.7177cfca.js"><link rel="prefetch" href="/assets/js/43.b745c235.js"><link rel="prefetch" href="/assets/js/44.6fa2e561.js"><link rel="prefetch" href="/assets/js/45.9ecc0f19.js"><link rel="prefetch" href="/assets/js/46.d47edb5a.js"><link rel="prefetch" href="/assets/js/47.f48a72bc.js"><link rel="prefetch" href="/assets/js/48.19da9fb3.js"><link rel="prefetch" href="/assets/js/49.a5d16804.js"><link rel="prefetch" href="/assets/js/50.5efb3589.js"><link rel="prefetch" href="/assets/js/51.6a21aa98.js"><link rel="prefetch" href="/assets/js/52.2947ff47.js"><link rel="prefetch" href="/assets/js/53.dc63262e.js"><link rel="prefetch" href="/assets/js/54.fa9b8371.js"><link rel="prefetch" href="/assets/js/55.d0f31e05.js"><link rel="prefetch" href="/assets/js/56.de8ec14d.js"><link rel="prefetch" href="/assets/js/57.73331274.js"><link rel="prefetch" href="/assets/js/58.4f67425f.js"><link rel="prefetch" href="/assets/js/59.318ec5bd.js"><link rel="prefetch" href="/assets/js/6.c999d008.js"><link rel="prefetch" href="/assets/js/60.f6a602f9.js"><link rel="prefetch" href="/assets/js/61.c659faf6.js"><link rel="prefetch" href="/assets/js/62.4ccc91f2.js"><link rel="prefetch" href="/assets/js/63.6e5e36a9.js"><link rel="prefetch" href="/assets/js/64.2660e08e.js"><link rel="prefetch" href="/assets/js/65.b06b0bed.js"><link rel="prefetch" href="/assets/js/66.1f836a7a.js"><link rel="prefetch" href="/assets/js/67.add88f29.js"><link rel="prefetch" href="/assets/js/68.e74a51fc.js"><link rel="prefetch" href="/assets/js/69.63126800.js"><link rel="prefetch" href="/assets/js/7.92efcfae.js"><link rel="prefetch" href="/assets/js/70.1dc8f877.js"><link rel="prefetch" href="/assets/js/71.856f3fe1.js"><link rel="prefetch" href="/assets/js/72.927e4ce2.js"><link rel="prefetch" href="/assets/js/73.2c1e909e.js"><link rel="prefetch" href="/assets/js/74.c8b565d2.js"><link rel="prefetch" href="/assets/js/75.00537c0a.js"><link rel="prefetch" href="/assets/js/76.492fbce1.js"><link rel="prefetch" href="/assets/js/77.6fb48b9b.js"><link rel="prefetch" href="/assets/js/78.d5aea725.js"><link rel="prefetch" href="/assets/js/8.81eb0648.js"><link rel="prefetch" href="/assets/js/9.1bebc5a8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.567624d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">crise's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineer/ui-fit.html" class="sidebar-link">移动端UI适配方案选择</a></li><li><a href="/blog/engineer/cli.html" class="sidebar-link">从 0 打造属于自己的脚手架</a></li><li><a href="/blog/engineer/vue3-template.html" aria-current="page" class="active sidebar-link">从 0 搭建 vue3+vite+typescript 企业级项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#搭建前准备" class="sidebar-link">搭建前准备</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#已实现的功能" class="sidebar-link">已实现的功能</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#模板依赖版本" class="sidebar-link">模板依赖版本</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#生成基本框架" class="sidebar-link">生成基本框架</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#做一些简单的配置" class="sidebar-link">做一些简单的配置</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#配置路由-vue-router4" class="sidebar-link">配置路由（vue-router4）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#安装依赖" class="sidebar-link">安装依赖</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#使用" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成状态管理库-pinia" class="sidebar-link">集成状态管理库 Pinia</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#pinia-有如下特点" class="sidebar-link">Pinia 有如下特点：</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#使用-2" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成移动端ui组件库-vant" class="sidebar-link">集成移动端UI组件库 vant</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#安装-2" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#按需引入组件" class="sidebar-link">按需引入组件</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#如何使用" class="sidebar-link">如何使用</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#移动端ui样式稿适配" class="sidebar-link">移动端UI样式稿适配</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成axios统一请求封装" class="sidebar-link">集成axios统一请求封装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#安装-3" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#使用-3" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#配置自动导入vue3-composition-api" class="sidebar-link">配置自动导入vue3 composition api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#安装-4" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#配置vite-config-ts" class="sidebar-link">配置vite.config.ts</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#配置自动引入vue3语法糖" class="sidebar-link">配置自动引入vue3语法糖</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#使用-4" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#配置-css-预处理器-less" class="sidebar-link">配置 css 预处理器 less</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#安装-5" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#配置全局-less-样式" class="sidebar-link">配置全局 less 样式</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#组件中使用" class="sidebar-link">组件中使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#环境变量配置" class="sidebar-link">环境变量配置</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#代码质量风格统一" class="sidebar-link">代码质量风格统一</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成-eslint" class="sidebar-link">集成 eslint</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成-prettier" class="sidebar-link">集成 prettier</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成-stylelint" class="sidebar-link">集成 stylelint</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成-husky-lint-staged" class="sidebar-link">集成 husky + lint-staged</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#代码提交规范统一" class="sidebar-link">代码提交规范统一</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成-commitizen-实现提交规范" class="sidebar-link">集成 Commitizen 实现提交规范</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#集成-commitlint-验证提交规范" class="sidebar-link">集成 commitlint 验证提交规范</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#单元测试" class="sidebar-link">单元测试</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#vite-常用基础配置" class="sidebar-link">Vite 常用基础配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#基础配置" class="sidebar-link">基础配置</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#生产环境生成-gz-文件" class="sidebar-link">生产环境生成 .gz 文件</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#最终-vite-config-ts" class="sidebar-link">最终 vite.config.ts</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#常用插件" class="sidebar-link">常用插件</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#非常推荐使用的-hooks-库" class="sidebar-link">非常推荐使用的 hooks 库</a></li><li class="sidebar-sub-header"><a href="/blog/engineer/vue3-template.html#写在最后" class="sidebar-link">写在最后</a></li></ul></li><li><a href="/blog/engineer/library-template.html" class="sidebar-link">从 0 搭建 rollup + typescript + jest 工具库</a></li><li><a href="/blog/engineer/eslintrc.html" class="sidebar-link">ESLint使用、原理及配置规则详解</a></li><li><a href="/blog/engineer/ci-cd.html" class="sidebar-link">工程化之CI/CD方案总结</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ts系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineer/tsconfig.html" class="sidebar-link">tsconfig.json配置详解</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>打包工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineer/bundle/babel.html" class="sidebar-link">babel</a></li><li><a href="/blog/engineer/bundle/babel-plugin.html" class="sidebar-link">babel常用插件</a></li><li><a href="/blog/engineer/bundle/rollup.html" class="sidebar-link">一文教会你配置rollup</a></li><li><a href="/blog/engineer/bundle/rollup-plugin.html" class="sidebar-link">rollup插件详解</a></li><li><a href="/blog/engineer/bundle/vite.html" class="sidebar-link">vite原理篇</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>web跨端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架与原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机与网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维与安全</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从-0-搭建-vue3-vite-typescript-企业级项目"><a href="#从-0-搭建-vue3-vite-typescript-企业级项目" class="header-anchor">#</a> 从 0 搭建 vue3+vite+typescript 企业级项目</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>随着 vue3.2 版本的发布，<code>&lt;script setup&gt;</code> 的实验性标志已经去掉，已经陆陆续续有不少公司开始使用 <code>vue3.2</code>开发项目了。
因为每次在开发新项目时，都需要一个开箱即用的基础框架，避免重新开始搭建而浪费时间，遂记录下从零开始搭建一个开箱即用的框架。该文旨在帮助大家搭建为团队开发的专属项目模板，模板主体为 vue3+vite+ts。</p> <h2 id="搭建前准备"><a href="#搭建前准备" class="header-anchor">#</a> 搭建前准备</h2> <ol><li><code>Vscode</code>: 前端人必备编码神器</li> <li><code>Chrome</code>：对开发者非常友好的浏览器(反正我是很依赖它的)</li> <li><code>Nodejs</code>&amp;<code>npm</code>：配置本地开发环境，安装 Node 后你会发现 npm 也会一起安装下来</li> <li><code>Vue.js devtools</code>：浏览器调试插件</li> <li><code>Vue Language Features (Volar)</code>：Vscode 开发 vue3 必备插件，提供语法高亮提示，非常好用</li> <li><code>eslint</code>：vscode 插件</li> <li><code>prettier</code>：vscode 格式化插件</li> <li><code>stylelint</code>：vscode 校验 css 插件</li> <li><code>stylelint plus</code>：vscode 校验 css，保存格式化插件</li> <li><code>Vue 3 Snippets</code>：vscode vue3 快捷输入提示插件</li> <li><code>whistle</code>：基于 Node 实现的跨平台 web 调试代理工具</li></ol> <h2 id="已实现的功能"><a href="#已实现的功能" class="header-anchor">#</a> 已实现的功能</h2> <p>✅ 表示已经实现的功能，📝 表示待实现</p> <table><thead><tr><th>功能</th> <th>状态</th></tr></thead> <tbody><tr><td>vue-router4</td> <td>✅</td></tr> <tr><td><code>vuex</code>状态管理工具<a href="https://pinia.vuejs.org/" target="_blank" rel="noopener noreferrer">pinia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + 数据持久化工具<a href="https://github.com/prazdevs/pinia-plugin-persistedstate" target="_blank" rel="noopener noreferrer">pinia-plugin-persistedstate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>✅</td></tr> <tr><td>UI 组件库 + 工具库</td> <td>✅</td></tr> <tr><td>移动端适配方案<a href="https://github.com/evrone/postcss-px-to-viewport" target="_blank" rel="noopener noreferrer">postcss-px-to-viewport<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>✅</td></tr> <tr><td>自动导入 composition api 和 生成全局 typescript 说明<a href="https://github.com/antfu/unplugin-auto-import" target="_blank" rel="noopener noreferrer">unplugin-auto-import<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>✅</td></tr> <tr><td>支持 vue3 语法糖($ref,$computed,$...)</td> <td>✅</td></tr> <tr><td>配置 <code>alias</code> 别名</td> <td>✅</td></tr> <tr><td>配置 <code>proxy</code> 跨域，支持在线 mock</td> <td>✅</td></tr> <tr><td>约束编码风格：<code>eslint</code> + <code>eslint/typescript</code> + <code>prettier</code>保存格式化</td> <td>✅</td></tr> <tr><td>代码提交强制校验：<code>husky</code> + <code>lint-staged</code></td> <td>✅</td></tr> <tr><td>代码提交 log 规范校验：<code>commitizen</code></td> <td>✅</td></tr> <tr><td>代码依赖分析工具：<code>rollup-plugin-visualizer</code></td> <td>✅</td></tr> <tr><td>兼容传统浏览器：<code>@vitejs/plugin-legacy</code></td> <td>✅</td></tr> <tr><td>使用<code>gzip</code>或者<code>brotli</code>来压缩资源：<code>vite-plugin-compression</code></td> <td>✅</td></tr> <tr><td>埋点工具<code>tracker</code>支持</td> <td>✅</td></tr> <tr><td><code>nativeSDK</code>支持</td> <td>✅</td></tr> <tr><td><code>SSR</code>支持</td> <td>📝</td></tr> <tr><td>支持<code>PC</code>端框架</td> <td>📝</td></tr> <tr><td><code>vite-plugin-vconsole</code>测试环境添加 vconsole</td> <td>📝</td></tr> <tr><td><code>vite-plugin-commonjs</code>支持 commonjs</td> <td>📝</td></tr> <tr><td><code>medusha</code>部署脚本</td> <td>📝</td></tr></tbody></table> <h2 id="模板依赖版本"><a href="#模板依赖版本" class="header-anchor">#</a> 模板依赖版本</h2> <ul><li><code>node：&gt;=v12.0.0</code></li> <li><code>vite：^2.8.0</code></li> <li><code>vue：^3.2.25</code></li> <li><code>typescript：^4.6.2</code></li> <li><code>pinia：^2.0.12</code></li> <li><code>vue-router：^4.0.13</code></li> <li><code>vueuse：^8.2.0</code></li> <li><code>eslint：^8.10.0</code></li> <li><code>prettier：^2.5.1</code></li> <li><code>postcss：^8.4.12</code></li> <li><code>stylelint: ^14.6.1</code></li> <li><code>husky：^7.0.4</code></li> <li><code>commitizen：^4.2.4</code></li></ul> <h2 id="生成基本框架"><a href="#生成基本框架" class="header-anchor">#</a> 生成基本框架</h2> <ol><li>使用官方提供 Vue3/ Vite 版本的模板来生成我们的基础项目。</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># npm 6.x</span>
<span class="token function">npm</span> create vite@latest my-vue-app --template vue-ts

<span class="token comment"># npm 7+, extra double-dash is needed:</span>
<span class="token function">npm</span> create vite@latest my-vue-app -- --template vue-ts

<span class="token comment"># yarn</span>
<span class="token function">yarn</span> create vite my-vue-app --template vue-ts

<span class="token comment"># pnpm</span>
<span class="token function">pnpm</span> create vite my-vue-app -- --template vue-ts
</code></pre></div><ol start="2"><li>使用<code>pnpm</code>安装依赖，固定依赖包版本号</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 安装依赖</span>
<span class="token function">pnpm</span> i

<span class="token comment"># 运行</span>
<span class="token function">pnpm</span> dev
</code></pre></div><h2 id="做一些简单的配置"><a href="#做一些简单的配置" class="header-anchor">#</a> 做一些简单的配置</h2> <p>基础模板中功能比较少，我们对生成的基础框架添加一些自定义的配置。</p> <ul><li>配置别名 @ 来表示 src 目录</li> <li>配置 mock 代理</li> <li>配置 hmr 解决利用<a href="https://github.com/avwo/whistle" target="_blank" rel="noopener noreferrer">whistle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>开发页面不断刷新的问题</li></ul> <ol><li>修改 <code>vite.config.ts</code> 文件</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 配置别名</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'@'</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 开发服务器配置</span>
    server<span class="token operator">:</span> <span class="token punctuation">{</span>
      port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
      hmr<span class="token operator">:</span> <span class="token punctuation">{</span>
        protocol<span class="token operator">:</span> <span class="token string">'ws'</span><span class="token punctuation">,</span>
        host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 设置 https 代理</span>
      proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            target<span class="token operator">:</span> <span class="token string">'your mock remote https address'</span><span class="token punctuation">,</span>
            changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></details> <ol start="2"><li>这时候项目文件会提示<code>ts</code>错误：</li></ol> <details class="custom-block details"><summary>点击查看图片</summary> <p><img src="/assets/img/type_node.071f38a0.png" alt="ts错误"></p></details> <p>为保证 node 使用，安装<code>@types/node</code>:
<code>@types/node</code>为项目中使用 nodejs api 提供了<code>.d.ts</code>这样的带有类型注解的导出声明</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i @types/node -D
</code></pre></div><ol start="3"><li>在 <code>tsconfig.json</code> 中添加配置，使编辑器可以识别我们的别名。</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/*&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="配置路由-vue-router4"><a href="#配置路由-vue-router4" class="header-anchor">#</a> 配置路由（vue-router4）</h2> <h3 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i vue-router --save
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <ol><li>新建 <code>src/router</code> 目录并在其下面创建 <code>index.ts</code>，导出 router</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory<span class="token punctuation">,</span> RouteRecordRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;/index&quot;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;首页&quot;</span><span class="token punctuation">,</span>
      keepAlive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      requireAuth<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;@/pages/index.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;/list&quot;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;List&quot;</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;列表页&quot;</span><span class="token punctuation">,</span>
      keepAlive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      requireAuth<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;@/pages/list.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  history<span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>
</code></pre></div></details> <ol start="2"><li>在 <code>main.ts</code> 中引入并使用</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code> <span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
 <span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
 <span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span><span class="token punctuation">;</span>

 <span class="token comment">// 创建vue实例</span>
 <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
 app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 挂载实例</span>
 app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>修改App.vue</li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouterView</span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="集成状态管理库-pinia"><a href="#集成状态管理库-pinia" class="header-anchor">#</a> 集成状态管理库 Pinia</h2> <blockquote><p><a href="https://pinia.vuejs.org/" target="_blank" rel="noopener noreferrer">Pinia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，是 Vue 官方团队推荐代替<code>Vuex</code>的一款轻量级状态管理库。由于 vuex 4 对 typescript 的支持让人感到难过，所以状态管理弃用了 vuex。</p></blockquote> <h3 id="pinia-有如下特点"><a href="#pinia-有如下特点" class="header-anchor">#</a> Pinia 有如下特点：</h3> <ul><li>完整的 typescript 的支持；</li> <li>足够轻量，压缩后的体积只有 1.6kb;</li> <li>去除 mutations，只有 state，getters，actions（这是我最喜欢的一个特点）；</li> <li>actions 支持同步和异步；</li> <li>没有模块嵌套，只有 store 的概念，store 之间可以自由使用，更好的代码分割；</li> <li>无需手动添加 store，store 一旦创建便会自动添加；</li></ul> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i pinia -S
</code></pre></div><h3 id="使用-2"><a href="#使用-2" class="header-anchor">#</a> 使用</h3> <ol><li>新建 src/store 目录并在其下面创建 index.ts，导出 store</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;pinia&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div></details> <ol start="2"><li>在 main.ts 中引入并使用</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 创建vue实例</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 挂载pinia</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 挂载实例</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>定义 State： 在 src/store 下面创建一个 city.ts</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;pinia&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useCityStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&quot;city&quot;</span><span class="token punctuation">,</span> <span class="token comment">// id必填，且需要唯一</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="4"><li>获取 State： 在 src/components/city.vue 中使用</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ cityStore.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useCityStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/city&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cityStore <span class="token operator">=</span> <span class="token function">useCityStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></details> <ol start="5"><li>修改 State：</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useCityStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/city&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cityStore <span class="token operator">=</span> <span class="token function">useCityStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1. 直接修改 state （不建议）</span>
cityStore<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;上海&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 2. 通过 actions 去修改</span>
cityStore<span class="token punctuation">.</span><span class="token function">updateName</span><span class="token punctuation">(</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></details> <h2 id="集成移动端ui组件库-vant"><a href="#集成移动端ui组件库-vant" class="header-anchor">#</a> 集成移动端UI组件库 <a href="https://youzan.github.io/vant/#/zh-CN/home" target="_blank" rel="noopener noreferrer">vant<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <blockquote><p>组件库选择上不做任何强制，根据自己的项目需要选择合适的组件库即可</p></blockquote> <h3 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> i vant
</code></pre></div><h3 id="按需引入组件"><a href="#按需引入组件" class="header-anchor">#</a> 按需引入组件</h3> <p>在 vite 项目中使用 Vant 时，推荐安装 <code>vite-plugin-style-import</code> 插件，它可以自动按需引入组件的样式。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i vite-plugin-style-import@1.4.1 -D
</code></pre></div><p>安装完成后，在 vite.config.ts 文件中配置插件：</p> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styleImport<span class="token punctuation">,</span> <span class="token punctuation">{</span> VantResolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite-plugin-style-import'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">styleImport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      resolves<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">VantResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <h3 id="如何使用"><a href="#如何使用" class="header-anchor">#</a> 如何使用</h3> <p><code>vant</code> 默认支持通过 Tree Shaking 实现 script 的按需引入。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vant'</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="移动端ui样式稿适配"><a href="#移动端ui样式稿适配" class="header-anchor">#</a> 移动端UI样式稿适配</h3> <blockquote><p>Vant 默认使用 px 作为样式单位，如果需要使用 viewport 单位 (vw, vh, vmin, vmax)，推荐使用 <a href="https://github.com/evrone/postcss-px-to-viewport" target="_blank" rel="noopener noreferrer">postcss-px-to-viewport<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行转换。</p></blockquote> <p><code>postcss-px-to-viewport</code> 是一款 PostCSS 插件，用于将 px 单位转化为 vw/vh 单位。</p> <p>下面提供了一份基本的 <code>PostCSS</code> 示例配置，可以在此配置的基础上根据项目需求进行修改。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>vant UI设计稿默认是375px</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'postcss-px-to-viewport'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">viewportWidth</span><span class="token operator">:</span> <span class="token number">375</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你当前项目设计稿默认是750px，就得根据不同文件进行对应的视口宽度转换</p> <details class="custom-block details"><summary>点击查看代码</summary> <p>首先安装基于<code>postcss-px-to-viewport</code>的衍生库</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i -D @jonny1994/postcss-px-to-viewport
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token string-property property">'@jonny1994/postcss-px-to-viewport'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unitToConvert</span><span class="token operator">:</span> <span class="token string">'px'</span><span class="token punctuation">,</span> <span class="token comment">// 需要转换的单位，默认为&quot;px&quot;</span>
      <span class="token literal-property property">viewportWidth</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
      <span class="token literal-property property">unitPrecision</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 单位转换后保留的精度</span>
      <span class="token literal-property property">propList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 能转化为 vw 的属性列表</span>
      <span class="token literal-property property">viewportUnit</span><span class="token operator">:</span> <span class="token string">'vw'</span><span class="token punctuation">,</span> <span class="token comment">// 希望使用的视窗单位</span>
      <span class="token literal-property property">fontViewportUnit</span><span class="token operator">:</span> <span class="token string">'vw'</span><span class="token punctuation">,</span> <span class="token comment">// 字体使用的视窗单位</span>
      <span class="token literal-property property">selectorBlackList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 需要忽略的 CSS 选择器，不会转为视窗单位，使用原有的 px 等单位</span>
      <span class="token literal-property property">minPixelValue</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 设置最小的转换数值，如果为 1 的话，只有大于 1 的值会被转换</span>
      <span class="token literal-property property">mediaQuery</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 媒体查询里的单位是否需要转换单位</span>
      <span class="token literal-property property">replace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否直接更换属性值，而不添加备用属性</span>
      <span class="token literal-property property">landscape</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否处理横屏情况,是否添加根据 landscapeWidth 生成的媒体查询条件</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vant</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 路径的正则或者字符串</span>
          <span class="token punctuation">(</span><span class="token parameter">pixels<span class="token punctuation">,</span> parsedVal<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'font'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>parsedVal <span class="token operator">*</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">vmin</span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>parsedVal <span class="token operator">*</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">vw</span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <h2 id="集成axios统一请求封装"><a href="#集成axios统一请求封装" class="header-anchor">#</a> 集成axios统一请求封装</h2> <blockquote><p>axios 是一个基于 promise 的 HTTP 库，可以用在浏览器和 node.js 中。</p></blockquote> <h3 id="安装-3"><a href="#安装-3" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i axios
</code></pre></div><h3 id="使用-3"><a href="#使用-3" class="header-anchor">#</a> 使用</h3> <p>实际使用中可以根据项目修改，比如<code>RESTful</code> <code>api</code>中可以自行添加<code>put</code>和<code>delete</code>请求,<code>ResType</code>也可以根据后端的通用返回值动态的去修改。</p> <ol><li>新建 <code>src/network/axios.ts</code>，用于<code>axios</code>封装</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code> <span class="token keyword">import</span> axios<span class="token punctuation">,</span> <span class="token punctuation">{</span> AxiosResponse<span class="token punctuation">,</span> AxiosRequestConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

 <span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// Request interceptors</span>
 service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
     <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token comment">// do something</span>
         <span class="token keyword">return</span> config<span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// Response interceptors</span>
 service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
     <span class="token keyword">async</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token comment">// do something</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token comment">// do something</span>
         <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">export</span> <span class="token keyword">default</span> service<span class="token punctuation">;</span>
</code></pre></div></details> <ol start="2"><li>新建 <code>src/network/user/index.ts</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/network/axios'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">IResponseType<span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
    code<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    status<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    data<span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">ILogin</span> <span class="token punctuation">{</span>
    token<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    expires<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span>username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span>IResponseType<span class="token operator">&lt;</span>ILogin<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">'/api/auth/login'</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
            username<span class="token punctuation">,</span>
            password
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>由于使用了 typescript，所以需新增 <code>types/shims-axios.d.ts</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AxiosRequestConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'axios'</span> <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
        <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token generic-function"><span class="token function">head</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token generic-function"><span class="token function">put</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token generic-function"><span class="token function">patch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <ol start="4"><li>在 <code>src/pages/user.vue</code> 页面中使用</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token constant">API</span> <span class="token keyword">from</span> <span class="token string">'@/network/user'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">requestRes</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></details> <p>除了自己手动封装 axios ,这里推荐一个 vue3 的请求封装库: <a href="https://www.attojs.com/" target="_blank" rel="noopener noreferrer">VueRequest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,非常好用。</p> <details class="custom-block details"><summary>点击查看功能介绍</summary> <ul><li>🚀 所有数据都具有响应式</li> <li>🔄 轮询请求</li> <li>🤖 自动处理错误重试</li> <li>🗄 内置请求缓存</li> <li>💧 节流请求与防抖请求</li> <li>🎯 聚焦页面时自动重新请求</li> <li>⚙️ 强大的分页扩展以及加载更多扩展</li> <li>📠 完全使用 Typescript 编写，具有强大的类型提示</li> <li>⚡️ 兼容 Vite</li> <li>🍃 轻量化</li> <li>📦 开箱即用</li></ul></details> <h2 id="配置自动导入vue3-composition-api"><a href="#配置自动导入vue3-composition-api" class="header-anchor">#</a> 配置自动导入vue3 composition api</h2> <h3 id="安装-4"><a href="#安装-4" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i unplugin-auto-import -D
</code></pre></div><h3 id="配置vite-config-ts"><a href="#配置vite-config-ts" class="header-anchor">#</a> 配置<code>vite.config.ts</code></h3> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> AutoImport <span class="token keyword">from</span> <span class="token string">'unplugin-auto-import/vite'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token function">AutoImport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.[tj]sx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// .ts, .tsx, .js, .jsx</span>
        <span class="token operator">/</span>\<span class="token punctuation">.</span>vue$<span class="token operator">/</span><span class="token punctuation">,</span>
        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue\?vue</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// .vue</span>
        <span class="token operator">/</span>\<span class="token punctuation">.</span>md$<span class="token operator">/</span><span class="token punctuation">,</span> <span class="token comment">// .md</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'vue'</span><span class="token punctuation">,</span>
        <span class="token string">'vue/macros'</span><span class="token punctuation">,</span>
        <span class="token string">'vue-router'</span><span class="token punctuation">,</span>
        <span class="token string">'pinia'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      eslintrc<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 第一次enabled得设成true，自动生成eslintrc-auto-import.json和auto-imports.d.ts文件</span>
        filepath<span class="token operator">:</span>  <span class="token string">'./.eslintrc-auto-import.json'</span><span class="token punctuation">,</span>
        globalsPropValue<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      dts<span class="token operator">:</span> <span class="token string">'./auto-imports.d.ts'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h3 id="配置自动引入vue3语法糖"><a href="#配置自动引入vue3语法糖" class="header-anchor">#</a> 配置自动引入vue3语法糖</h3> <blockquote><p>很多人对项目中使用ref，computed等api，然后js中得使用.value的形式很不爽，vue官方特地提供了类似于<a href="https://github.com/vuejs/rfcs/discussions/369" target="_blank" rel="noopener noreferrer">$ref<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等写法的语法糖
配置<code>vite.config.ts</code>，在项目中不需要引入自动使用</p></blockquote> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span>
<span class="token keyword">import</span> AutoImport <span class="token keyword">from</span> <span class="token string">'unplugin-auto-import/vite'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      reactivityTransform<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">AutoImport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token operator">...</span>
        <span class="token string">'vue/macros'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h3 id="使用-4"><a href="#使用-4" class="header-anchor">#</a> 使用</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">$ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="配置-css-预处理器-less"><a href="#配置-css-预处理器-less" class="header-anchor">#</a> 配置 css 预处理器 less</h2> <blockquote><p>虽然 <code>vite</code> 原生支持 <code>less/sass/scss/stylus</code>，但是你必须手动安装他们的预处理器依赖</p></blockquote> <h3 id="安装-5"><a href="#安装-5" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token function">less</span> -D
</code></pre></div><h3 id="配置全局-less-样式"><a href="#配置全局-less-样式" class="header-anchor">#</a> 配置全局 less 样式</h3> <p>在 <code>src/assets</code> 下新增 <code>style</code> 文件夹，用于存放全局样式文件，可以用来实现换肤，主题配置等功能</p> <p>新建 <code>index.less</code>, 设置一个用于测试的颜色<code>变量</code> :</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token variable">@theme-color<span class="token punctuation">:</span></span> dark<span class="token punctuation">;</span>
</code></pre></div><p>如何将这个全局样式文件<code>全局注入</code>到项目中呢？配置 <code>Vite</code> 即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">css</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token literal-property property">less</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">additionalData</span><span class="token operator">:</span><span class="token string">'@import &quot;@/assets/style/index.less&quot;;'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="组件中使用"><a href="#组件中使用" class="header-anchor">#</a> 组件中使用</h3> <blockquote><p>不需要任何引入可以直接使用全局<code>less</code>定义的变量</p></blockquote> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.theme</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token variable">@theme-color</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="环境变量配置"><a href="#环境变量配置" class="header-anchor">#</a> 环境变量配置</h2> <blockquote><p><code>vite</code> 提供了两种模式：具有开发服务器的<code>开发模式</code>（development）和<code>生产模式</code>（production）。<code>vite serve</code>时模式默认是development，<code>vite build</code>时是production。</p></blockquote> <p>项目根目录新建:<code>.env.development</code> :</p> <div class="language-env extra-class"><pre class="language-text"><code>NODE_ENV=development

VITE_APP_WEB_URL= 'YOUR WEB URL'
</code></pre></div><p>项目根目录新建:<code>.env.production</code> :</p> <div class="language-env extra-class"><pre class="language-text"><code>NODE_ENV=production

VITE_APP_WEB_URL= 'YOUR WEB URL'
</code></pre></div><p>组件中使用：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APP_WEB_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>配置 <code>package.json</code>:</p> <blockquote><p>打包区分开发环境和生产环境</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;build:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-tsc --noEmit &amp;&amp; vite build --mode development&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;build:pro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-tsc --noEmit &amp;&amp; vite build --mode production&quot;</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="代码质量风格统一"><a href="#代码质量风格统一" class="header-anchor">#</a> 代码质量风格统一</h2> <h3 id="集成-eslint"><a href="#集成-eslint" class="header-anchor">#</a> 集成 eslint</h3> <blockquote><p><code>ESLint</code> 主要负责: 质量检查(例如使用了某个变量却忘记了定义)、风格检查</p></blockquote> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i eslint eslint-plugin-import eslint-plugin-vue eslint-config-airbnb-base -D
</code></pre></div><p>由于 <code>ESLint</code> 默认使用 <a href="https://github.com/eslint/espree" target="_blank" rel="noopener noreferrer">Espree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行语法解析，无法识别 TypeScript 的一些语法，故我们需要安装 <code>@typescript-eslint/parser</code> 替代掉默认的解析器</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i @typescript-eslint/parser -D
</code></pre></div><p>安装对应的插件 <a href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin" target="_blank" rel="noopener noreferrer">@typescript-eslint/eslint-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 它作为 eslint 默认规则的补充，提供了一些额外的适用于 ts 语法的规则。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i @typescript-eslint/eslint-plugin -D
</code></pre></div><ol start="2"><li>创建配置文件： <code>.eslintrc.js</code> 或 <code>.eslintrc.json</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;vue-eslint-parser&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> latest<span class="token punctuation">,</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'@typescript-eslint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;plugin:vue/vue3-recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">'airbnb-base'</span><span class="token punctuation">,</span>
    <span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// override/add rules settings here, such as:</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>创建忽略文件：<code>.eslintignore</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>*.sh
node_modules
*.md
*.woff
*.ttf
.vscode
.idea
dist
/public
/docs
.husky
.local
/bin
Dockerfile
</code></pre></div><h3 id="集成-prettier"><a href="#集成-prettier" class="header-anchor">#</a> 集成 prettier</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li><code>prettier</code>主要负责: 风格检查, 没有质量检查。虽然 eslint 本身只提供了部分风格检查，但是这导致有部分的代码依然没有实现风格检查，具体细节下面会说。对于大多数实际项目，都会使用<code>prettier</code>进行风格检查。由于会出现引入多个风格检查的插件和配置 lint，这就导致存在部分会与 prettier 的 lint 出现冲突，因此需要 lint 预设包。</li> <li><code>eslint-config-prettier</code>，这个包的作用是先关闭这些与 prettier 冲突的 lint 规则，然后之后再启用 prettier 的规则，使得冲突的 lint 规则以 prettier 为准。</li> <li><code>eslint-plugin-prettier</code>插件会调用<code>prettier</code>对你的代码风格进行检查，其原理是先使用 prettier 对你的代码进行格式化，然后与格式化之前的代码进行对比，如果过出现了不一致，这个地方就会被 prettier 进行标记。</li></ol></div> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i prettier eslint-config-prettier eslint-plugin-prettier -D
</code></pre></div><ol start="2"><li>创建配置文件： <code>prettier.config.js</code> 或 <code>.prettierrc.js</code> 或 <code>.prettierrc</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 一行最多 80 字符</span>
  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用 4 个空格缩进</span>
  <span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token comment">// 不使用 tab 缩进，而使用空格</span>
  <span class="token literal-property property">useTabs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 行尾需要有分号</span>
  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用单引号代替双引号</span>
  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 对象的 key 仅在必要时用引号</span>
  <span class="token literal-property property">quoteProps</span><span class="token operator">:</span> <span class="token string">&quot;as-needed&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// jsx 不使用单引号，而使用双引号</span>
  <span class="token literal-property property">jsxSingleQuote</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 末尾使用逗号</span>
  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 大括号内的首尾需要空格 { foo: bar }</span>
  <span class="token literal-property property">bracketSpacing</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// jsx 标签的反尖括号需要换行</span>
  <span class="token literal-property property">jsxBracketSameLine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 箭头函数，只有一个参数的时候，也需要括号</span>
  <span class="token literal-property property">arrowParens</span><span class="token operator">:</span> <span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 每个文件格式化的范围是文件的全部内容</span>
  <span class="token literal-property property">rangeStart</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rangeEnd</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否需要写文件开头的 @prettier</span>
  <span class="token literal-property property">requirePragma</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否自动在文件开头插入 @prettier</span>
  <span class="token literal-property property">insertPragma</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用默认的折行标准</span>
  <span class="token literal-property property">proseWrap</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 根据显示样式决定 html 要不要折行</span>
  <span class="token literal-property property">htmlWhitespaceSensitivity</span><span class="token operator">:</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 换行符使用 lf</span>
  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">&quot;lf&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>修改 <code>.eslintrc.js</code> 配置</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'@typescript-eslint'</span><span class="token punctuation">,</span> <span class="token string">'prettier'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'plugin:vue/vue3-recommended'</span><span class="token punctuation">,</span>
        <span class="token string">'airbnb-base'</span><span class="token punctuation">,</span>
        <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span>
        <span class="token string">'prettier'</span><span class="token punctuation">,</span>
        <span class="token string">'plugin:prettier/recommended'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <p>更多配置，可以查看<a href="https://prettier.io/docs/en/options.html#print-width" target="_blank" rel="noopener noreferrer">Prettier Options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
在设置中，搜索 <code>save</code> ，勾选 <code>Format On Save</code>：
<img src="/assets/img/save.afaab03c.png" alt="format on save">
然后在 setting.json 中增加配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;[javascript]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="集成-stylelint"><a href="#集成-stylelint" class="header-anchor">#</a> 集成 stylelint</h3> <p>如何编写 CSS 以及如何在浏览器中加载样式表都会对加载时间造成重大影响。css 的书写顺序很重要，会影响浏览器的渲染。正确的书写可以减少浏览器的回流，提升浏览器的 dom 渲染。
stylelint 致力于类 css 文件的静态检查，可以帮助我们规范化 css 的书写，风格统一，避免样式文件的错误。</p> <ol><li>安装<div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>stylelint</code>14 以上版本 peerDependencies 依赖<code>postcss</code>8 以上版本，直接引入<code>postcss</code>，可以统一<code>postcss</code>版本，防止后续 postcss 及 stylelint 相关插件带来的其他问题</p></div></li></ol> <ul><li>项目中使用 less</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i -D postcss postcss-html postcss-less stylelint stylelint-config-html stylelint-order stylelint-config-rational-order stylelint-config-prettier
</code></pre></div><details class="custom-block details"><summary>点击查看插件介绍</summary> <blockquote><ul><li><code>postcss-html</code> 用于解析 HTML（和类似 HTML）的 PostCSS 语法，比如 html，xml，vue，svelte，php</li> <li><code>postcss-less</code> 用于解析 less 的 PostCSS 语法</li> <li><code>stylelint-config-html</code> 此配置捆绑 postcss-html 自定义语法并对其进行配置，如果您在 Stylelint 配置中使用此配置，HTML、XML、Vue、Svelte 和 PHP 文件将是可解析的</li> <li><code>stylelint-order</code> stylelint 插件，提供与 css 排序相关的参数，以及作用相关规则到 stylelint</li> <li><code>stylelint-config-rational-order</code> 提供 css 属性的排序规则</li> <li><code>stylelint-config-prettier</code> 关闭所有不必要或可能与 Prettier 冲突的 CSS 规则</li></ul></blockquote></details> <ul><li>项目中使用 scss</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i -D postcss stylelint stylelint-config-recommended-scss stylelint-config-recommended-vue stylelint-config-standard-scss stylelint-order stylelint-config-rational-order stylelint-config-prettier-scss
</code></pre></div><details class="custom-block details"><summary>点击查看插件介绍</summary> <blockquote><ul><li><code>stylelint-config-recommended-scss</code> 推荐的 scss 共享配置</li> <li><code>stylelint-config-recommended-vue</code> 推荐的 vue 共享配置</li> <li><code>stylelint-config-recommended-scss</code>规则）</li> <li><code>stylelint-order</code> stylelint 插件，提供与 css 排序相关的参数，以及作用相关规则到 stylelint</li> <li><code>stylelint-config-rational-order</code> 提供 css 属性的排序规则</li> <li><code>stylelint-config-prettier-scss</code> 关闭所有不必要或可能与 Prettier 冲突的 CSS 和 SCSS 规则</li></ul></blockquote></details> <ol start="2"><li>根目录下新增配置文件 <code>.stylelintrc.js</code> 或 <code>stylelint.config.js</code></li></ol> <ul><li>项目中使用 less</li></ul> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stylelint-order&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;stylelint-config-html/vue&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stylelint-config-rational-order&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stylelint-config-prettier&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">customSyntax</span><span class="token operator">:</span> <span class="token string">&quot;postcss-html&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;string-quotes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;single&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 单引号</span>
    <span class="token string-property property">&quot;at-rule-no-unknown&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;selector-class-pattern&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;unit-allowed-list&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vw&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ignoreFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/*.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/*.tsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/*.ts&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 特殊文件的配置</span>
  <span class="token literal-property property">overrides</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.(less|css)&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">customSyntax</span><span class="token operator">:</span> <span class="token string">&quot;postcss-less&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ul><li>项目中使用 scss</li></ul> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stylelint-order&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;stylelint-config-standard-scss&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stylelint-config-recommended-vue&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stylelint-config-recommended-vue/scss&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stylelint-config-rational-order&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stylelint-config-prettier-scss&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>增加 <code>stylelint</code> 的忽略文件 <code>.stylelintignore</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>src/**/*.js
src/**/*.ts
dist
node_modules
index.html
*.md
</code></pre></div><ol start="4"><li>配置<code>VSCode</code>格式化</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>Save</code>时格式化：下面的 json 型设置需要写到.vscode 文件夹的<code>setting.json</code>里</p></div> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 保存时使用VSCode 自身格式化程序格式化，触发自动保存机制。</span>
  <span class="token property">&quot;editor.formatOnSave&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;source.fixAll.eslint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;source.fixAll.stylelint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 开启stylelint校验</span>
  <span class="token property">&quot;stylelint.enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 开启之后格式化vue文件时terminal会不断报错</span>
  <span class="token comment">// &quot;stylelint.validate&quot;: [&quot;css&quot;, &quot;less&quot;, &quot;vue&quot;],</span>
  <span class="token comment">// 自动保存触发stylelint(stylelint-plus插件命令)</span>
  <span class="token property">&quot;stylelint.autoFixOnSave&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[vue]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 默认格式化走prettier</span>
  <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 各种文件格式化规则</span>
  <span class="token property">&quot;[javascriptreact]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[typescript]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[typescriptreact]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[html]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[css]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[less]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[scss]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[jsonc]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[json]&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;editor.defaultFormatter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esbenp.prettier-vscode&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 两者如果在格式化js时冲突，需要关闭默认js格式化程序</span>
  <span class="token comment">// &quot;javascript.format.enable&quot;: false</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h3 id="集成-husky-lint-staged"><a href="#集成-husky-lint-staged" class="header-anchor">#</a> 集成 husky + lint-staged</h3> <ol><li>安装 husky</li></ol> <p><code>husky</code> 是一个为 git 客户端增加 <code>hook</code> 的工具。安装后，它会自动在仓库中的 <code>.git/</code> 目录下增加相应的钩子；比如 <code>pre-commit</code> 钩子就会在你执行 <code>git commit</code> 的触发。</p> <p>那么我们可以在 <code>pre-commit</code> 中实现一些比如 <code>lint 检查</code>、<code>单元测试</code>、<code>代码美化</code>等操作。当然，<code>pre-commit</code> 阶段执行的命令当然要保证其速度不要太慢，每次 commit 都等很久也不是什么好的体验。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx husky-init <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><p>这行命令做了四件事：</p> <ul><li>安装 husky 到开发依赖</li> <li>在项目根目录下创建 .husky 目录</li> <li>在 .husky 目录创建 pre-commit hook，并初始化 pre-commit 命令为 npm test</li> <li>修改 package.json 的 scripts，增加 &quot;prepare&quot;: &quot;husky install&quot;</li></ul> <p>安装成功后会发现项目中多了一个<code>.husky</code>文件夹:
<img src="/assets/img/husky.0551ac8e.png" alt="husky"></p> <p>到这里，husky 配置完毕，现在我们来使用它：</p> <p>husky 包含很多 <code>hook</code>（钩子），常用有：<code>pre-commit</code>、<code>commit-msg</code>、<code>pre-push</code>。这里，我们使用 pre-commit 来触发 ESLint 命令。</p> <p>修改 .husky/pre-commit hook 文件的触发命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>eslint --fix ./src --ext .vue,.js,.ts
</code></pre></div><p>上面这个 <code>pre-commit</code> hook 文件的作用是：</p> <p>当我们执行 <code>git commit -m &quot;xxx&quot;</code> 时，会先对 src 目录下所有的 .vue、.js、.ts  文件执行 eslint --fix 命令，如果 ESLint 通过，成功 commit，否则终止 commit。</p> <p>但是又存在一个问题：有时候我们明明只改动了一两个文件，却要对所有的文件执行 eslint --fix。</p> <p>假如这是一个历史项目，我们在中途配置了<code>ESLint</code>规则，那么在提交代码时，也会对其他未修改的“历史”文件都进行检查，可能会造成大量文件出现 <code>ESLint</code>错误，显然不是我们想要的结果。
我们要做到只用<code>ESLint</code>修复自己此次写的代码，而不去影响其他的代码。所以我们还需借助一个神奇的工具<code>lint-staged</code>。</p> <ol start="2"><li>配置lint-staged</li></ol> <p><code>lint-staged</code> 这个工具一般结合 husky 来使用，它可以让 husky 的 hook 触发的命令只作用于 git add那些文件（即 git 暂存区的文件），而不会影响到其他文件。</p> <p>接下来，我们使用 lint-staged 继续优化项目。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> i lint-staged -D
</code></pre></div><p>在 <code>package.json</code> 里增加 lint-staged 配置项</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;*.{js,ts,vue}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;eslint --cache --fix&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">&quot;*.{vue,less}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;stylelint --fix  --custom-syntax postcss-less&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这行命令表示：只对 <code>git 暂存区</code>的 <code>.vue、.js、.ts</code> 文件执行 <code>eslint --fix</code>。</p> <ol start="3"><li>修改 <code>.husky/pre-commit</code> hook 的触发命令为：<code>npx lint-staged</code> <img src="/assets/img/husky.0551ac8e.png" alt="husky">
至此，<code>husky</code> 和 <code>lint-staged</code> 组合配置完成。</li></ol> <p>现在我们提交代码时就会变成这样：</p> <p>假如我们修改了 src 目录下的 <code>user.vue</code> 以及 根目录下的 <code>vite.config.ts</code> 文件，然后 git add ./src/，最后 git commit -m &quot;test...&quot;，这时候就会只对 <code>user.vue</code> 这两个文件执行 <code>eslint --fix</code> 和 <code>stylelint --fix</code>。如果 ESLint 和 stylelint通过，成功提交，否则终止提交。从而保证了我们提交到 Git 仓库的代码都是规范的。</p> <h2 id="代码提交规范统一"><a href="#代码提交规范统一" class="header-anchor">#</a> 代码提交规范统一</h2> <blockquote><p>为了使团队多人协作更加的规范，所以需要每次在 git 提交的时候，做一次硬性规范提交，规范 git 的提交信息。</p></blockquote> <p>如果 git commit 的描述信息精准，在后期维护和 Bug 处理时会变得有据可查，项目开发周期内还可以根据规范的提交信息快速生成开发日志，从而方便我们追踪项目和把控进度。</p> <p>这里，我们使用社区最流行、最知名、最受认可的 <a href="https://github.com/angular/angular/commits/master" target="_blank" rel="noopener noreferrer">Angular 团队提交规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="集成-commitizen-实现提交规范"><a href="#集成-commitizen-实现提交规范" class="header-anchor">#</a> 集成 <a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener noreferrer">Commitizen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现提交规范</h3> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i -D commitizen cz-customizable
</code></pre></div><ol start="2"><li>配置<code>package.json</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;commit&quot;</span><span class="token operator">:</span><span class="token string">&quot;cz&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/cz-customizable&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div></details> <ol start="3"><li>自定义提示则添加 <code>.cz-config.js</code></li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可选类型</span>
  <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'feat'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'feat:     新功能'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'fix:      修复'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'docs:     文档变更'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'style:    代码风格相关(不影响代码运行的变动)'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'refactor'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'refactor: 重构(既不是增加feature，也不是修复bug)'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'perf'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'perf:     性能优化'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test:     测试相关'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'chore'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'chore:    依赖更新/脚手架配置修改等'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'revert'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'revert:   撤销修改'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'workflow'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'workflow:    工作流改进'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'ci'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ci:    持续集成'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'types'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'types:    类型定义文件更改'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'wip'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wip:    开发中'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 消息步骤</span>
  <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'请选择提交类型:'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">customScope</span><span class="token operator">:</span> <span class="token string">'请输入修改范围(可选):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'请简要描述提交(必填):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">'请输入详细描述(可选):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">footer</span><span class="token operator">:</span> <span class="token string">'请输入要关闭的issue(可选):'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">confirmCommit</span><span class="token operator">:</span> <span class="token string">'确认使用以上信息提交？(y/n/e/h)'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 跳过问题</span>
  <span class="token literal-property property">skipQuestions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token string">'footer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// subject文字长度默认是72</span>
  <span class="token literal-property property">subjectLimit</span><span class="token operator">:</span> <span class="token number">72</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="4"><li>交互界面测试</li></ol> <details class="custom-block details"><summary>点击查看图片</summary> <p><img src="/assets/img/cz.f1e46ba6.png" alt="commitizen"></p></details> <h3 id="集成-commitlint-验证提交规范"><a href="#集成-commitlint-验证提交规范" class="header-anchor">#</a> 集成 commitlint 验证提交规范</h3> <p>在“代码规范”章节，我们已经讲到过，尽管制定了规范，但在多人协作的项目中，总有些人依旧我行我素，因此提交代码这个环节，我们也增加一个限制：只让符合规范的 commit message 通过，我们借助 <code>@commitlint/config-conventional</code> 和 <code>@commitlint/cli</code> 来实现。</p> <ol><li>安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i @commitlint/config-conventional @commitlint/cli -D
</code></pre></div><ol start="2"><li>新增配置 <code>commitlint.config.js</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@commitlint/config-conventional'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>使用 husky 的 <code>commit-msg</code> hook 触发验证提交信息的命令</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>npx husky <span class="token function">add</span> .husky/commit-msg <span class="token string">&quot;npx --no-install commitlint --edit <span class="token variable">$1</span>&quot;</span>
</code></pre></div><p>使用 husky 命令在 <code>.husky</code> 目录下创建 <code>commit-msg</code> 文件，并在此执行 <code>commit message</code> 的验证命令。
<img src="/assets/img/commitlint.d000feec.png" alt="commitlint">
4. <code>commitlint</code> 验证</p> <ul><li>不符合规范的提交信息
如下图，提交信息 <code>test commitlint</code> 不符合规范，提交失败。
<img src="/assets/img/test_commitlint.63c34a4b.png" alt="test commitlint"></li> <li>符合规范的提交信息
提交信息 <code>chore: commitlint test</code> 符合规范，成功提交到仓库。</li></ul> <h2 id="单元测试"><a href="#单元测试" class="header-anchor">#</a> 单元测试</h2> <blockquote><p>单元测试允许你将独立单元的代码进行隔离测试，完整的测试能为代码和业务提供质量保证，减少 Bug 的出现。通过编写细致且有意义的测试，你能够有信心在构建新特性或重构已有代码的同时，保持应用的功能和稳定。</p></blockquote> <ol><li>安装依赖</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i @vue/test-utils jest @vue/vue3-jest ts-jest @types/jest -D
</code></pre></div><p>由于<code>@vue/vue3-jest</code>和<code>ts-jest</code> peerDependancies 依赖 <code>@babel/core</code> 和 <code>babel-jest</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> i @babel/core babel-jest -D
</code></pre></div><ol start="2"><li>配置<code>jest.config.js</code>文件</li></ol> <details class="custom-block details"><summary>点击查看代码</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">preset</span><span class="token operator">:</span> <span class="token string">'ts-jest'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">'jsdom'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'^.+\\.vue$'</span><span class="token operator">:</span> <span class="token string">'vue-jest'</span><span class="token punctuation">,</span> <span class="token comment">// vue 文件用 vue-jest 转换</span>
    <span class="token string-property property">'^.+\\.ts$'</span><span class="token operator">:</span> <span class="token string">'ts-jest'</span> <span class="token comment">// ts 文件用 ts-jest 转换</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// support the same @ -&gt; src alias mapping in source code</span>
  <span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'^@/(.*)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/src/$1'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'^~/(.*)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/$1'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'^(\\.{1,2}/.*)\\.js$'</span><span class="token operator">:</span> <span class="token string">'$1'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 匹配 __tests__ 目录下的 .js/.ts 文件 或其他目录下的 xx.test.js/ts xx.spec.js/ts</span>
  <span class="token literal-property property">testRegex</span><span class="token operator">:</span> <span class="token string">'(/__tests__/.*|(\\.|/)(test|spec))\\.(ts)$'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <ol start="3"><li>执行单元测试</li></ol> <p>在根目录下 <code>package.json</code> 文件的 scripts 中，添加一条单元测试命令： &quot;test:unit&quot;: &quot;jest&quot;。
执行命令 <code>npm run test:unit</code> 即可进行单元测试，jest 会根据 <code>jest.config.js</code> 配置文件去查找 <strong>tests</strong> 目录下的 .ts 文件或其他任意目录下的 .spec.ts 和 .test.ts 文件，然后执行单元测试方法。</p> <blockquote><p>你可以在 <code>jest.config.js</code> 配置文件中，自由配置单元测试文件的目录。</p></blockquote> <ul><li>单元测试全部通过时的终端显示信息
<img src="/assets/img/jest.92dd7e35.png" alt="jest"></li> <li>单元测试未全部通过时的终端显示信息
<img src="/assets/img/jest_fail.8444e923.png" alt="jest_fail">
当单元测试没有全部通过时，我们需要根据报错信息去优化对应组件的代码，进一步提高项目健壮性。但是写单元测试是件比较痛苦的事，我个人觉得也没必要全部组件都写单元测试，根据项目实际情况有针对性去写就行了。</li></ul> <ol start="4"><li>单元测试约束</li></ol> <p>前面，我们使用 <code>husky</code> 在 Git 的 <code>pre-commit</code> 和 <code>commit-msg</code> 阶段分别约束代码风格规范和提交信息规范。这一步，我们在 <code>pre-push</code> 阶段进行单元测试，只有单元测试全部通过才让代码 push 到远端仓库，否则终止 push。</p> <p>使用 husky 命令在 <code>.husky</code> 目录下自动创建 <code>pre-push</code> hook 文件，并在此执行单元测试命令 <code>npm run test:unit</code>。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx husky <span class="token function">add</span> .husky/pre-push <span class="token string">&quot;npm run test:unit <span class="token variable">$1</span>&quot;</span>
</code></pre></div><p>现在，我们在 git push 时就能先进行单元测试了，只有单元测试全部通过，才能成功 push。</p> <h2 id="vite-常用基础配置"><a href="#vite-常用基础配置" class="header-anchor">#</a> Vite 常用基础配置</h2> <h3 id="基础配置"><a href="#基础配置" class="header-anchor">#</a> 基础配置</h3> <h4 id="运行-代理-和-打包-配置"><a href="#运行-代理-和-打包-配置" class="header-anchor">#</a> <code>运行</code> <code>代理</code> 和 <code>打包</code> 配置</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">https</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="生产环境去除-console-debugger"><a href="#生产环境去除-console-debugger" class="header-anchor">#</a> 生产环境去除 <code>console</code> <code>debugger</code></h4> <p>如果你项目运行<code>pnpm dev</code>的时候，出现了<code>Note Vite now defaults to use esbuild for minification. If you still prefer Terser, set build.minify to &quot;terser</code>的提示，说明你当前vite版本(2.6.x版本及之前)默认的压缩混淆工具为<a href="https://github.com/evanw/esbuild" target="_blank" rel="noopener noreferrer">esbuild<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，则需要手动将<code>minify</code>参数置为<code>terser</code>。</p> <h5 id="安装依赖-2"><a href="#安装依赖-2" class="header-anchor">#</a> 安装依赖</h5> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> <span class="token function">add</span> rollup-plugin-terser
</code></pre></div><h5 id="文件配置"><a href="#文件配置" class="header-anchor">#</a> 文件配置</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">build</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token string">'terser'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">drop_debugger</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ps：经过测试，<code>minify</code>参数为<code>esbuild</code>的时候，打包过程中会把<code>try...catch()</code>代码中<code>catch</code>后面的<code>()</code>给去掉，最终会导致传统浏览器<code>(script type=&quot;nomodule&quot;)</code>白屏。</p> <h3 id="生产环境生成-gz-文件"><a href="#生产环境生成-gz-文件" class="header-anchor">#</a> 生产环境生成 .gz 文件</h3> <blockquote><p>开启 <code>gzip</code> 可以极大的压缩静态资源，对页面加载的速度起到了显著的作用。</p></blockquote> <p>使用 <code>vite-plugin-compression</code> 可以 <code>gzip</code> 或 <code>brotli</code> 的方式来压缩资源，这一步需要服务器端的配合，<code>vite</code> 只能帮你打包出 <code>.gz</code> 文件。此插件使用简单，你甚至无需配置参数，引入即可。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev vite-plugin-compression
</code></pre></div><p>plugins 中添加：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">'vite-plugin-compression'</span>

<span class="token comment">// gzip压缩 生产环境生成 .gz 文件</span>
<span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">disable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
      <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">'gzip'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">'.gz'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="最终-vite-config-ts"><a href="#最终-vite-config-ts" class="header-anchor">#</a> 最终 vite.config.ts</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&quot;@vitejs/plugin-vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//@ts-ignore</span>
<span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-compression&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包路径</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// gzip压缩 生产环境生成 .gz 文件</span>
    <span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">disable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
      <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;gzip&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">&quot;.gz&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 配置别名</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">additionalData</span><span class="token operator">:</span> <span class="token string">'@import &quot;@/assets/style/index.less&quot;;'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//启动服务配置</span>
  <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">https</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 生产环境打包配置</span>
  <span class="token comment">//去除 console debugger</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">drop_debugger</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="常用插件"><a href="#常用插件" class="header-anchor">#</a> 常用插件</h2> <blockquote><p>可以查看官方文档：https://vitejs.cn/plugins/</p></blockquote> <ul><li><code>@vitejs/plugin-vue</code> 提供 <code>Vue 3</code> 单文件组件支持</li> <li><code>@vitejs/plugin-vue-jsx</code> 提供 Vue 3 <code>JSX</code> 支持（通过 专用的 Babel 转换插件）</li> <li><code>@vitejs/plugin-legacy</code> 为打包后的文件提供传统浏览器<code>兼容性</code>支持</li> <li><code>unplugin-vue-components</code> 组件的按需自动导入</li> <li><code>vite-plugin-compression</code> 使用 gzip 或者 brotli 来压缩资源</li> <li>.....</li></ul> <h2 id="非常推荐使用的-hooks-库"><a href="#非常推荐使用的-hooks-库" class="header-anchor">#</a> 非常推荐使用的 hooks 库</h2> <blockquote><p>因为<code>vue3.x</code>和<code>react hooks</code>真的很像，所以就称为 <code>hooks</code></p></blockquote> <p><code>VueUse</code>：https://vueuse.org/</p> <p><img src="https://files.mdnice.com/user/16854/cbf73b46-d22b-44e7-bca1-c33764e41784.png" alt=""></p> <p>看到这个库的第一眼，让我立马想到了 react 的 <code>ahooks</code></p> <p><code>VueUse</code> 是一个基于 <code>Composition API</code> 的实用函数集合。通俗的来说，这就是一个<code>工具函数</code>包，它可以帮助你快速实现一些常见的功能，免得你自己去写，解决重复的工作内容。以及进行了基于 Composition API 的封装。让你在 vue3 中更加得心应手。</p> <p>💡 想要入手 vue3 的小伙伴，赶快学习起来吧！！！</p> <h2 id="写在最后"><a href="#写在最后" class="header-anchor">#</a> 写在最后</h2> <blockquote><p><code>公众号</code>：<code>前端开发爱好者</code> 专注分享 <code>web</code> 前端相关<code>技术文章</code>、<code>视频教程</code>资源、热点资讯等，如果喜欢我的分享，给 🐟🐟 点一个<code>赞</code> 👍 或者 ➕<code>关注</code> 都是对我最大的支持。</p></blockquote> <p>欢迎<code>长按图片加好友</code>，我会第一时间和你分享<code>前端行业趋势</code>，<code>面试资源</code>，<code>学习途径</code>等等。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/engineer/cli.html" class="prev">
        从 0 打造属于自己的脚手架
      </a></span> <span class="next"><a href="/blog/engineer/library-template.html">
        从 0 搭建 rollup + typescript + jest 工具库
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.92dc81f6.js" defer></script><script src="/assets/js/2.2d54ebdc.js" defer></script><script src="/assets/js/5.1898d05c.js" defer></script>
  </body>
</html>
