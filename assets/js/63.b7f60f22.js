(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{558:function(s,t,a){"use strict";a.r(t);var n=a(65),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"服务器部署node项目-看这一篇就够了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器部署node项目-看这一篇就够了"}},[s._v("#")]),s._v(" 服务器部署node项目，看这一篇就够了")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("ul",[a("li",[s._v("客户机使用的系统：macOS")]),s._v(" "),a("li",[s._v("服务器使用的系统: centOS 8")]),s._v(" "),a("li",[s._v("node版本: 16.15.0")]),s._v(" "),a("li",[s._v("nginx版本: 1.22.0")]),s._v(" "),a("li",[s._v("mysql版本: 8.0.26")])]),s._v(" "),a("h2",{attrs:{id:"安装node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装node"}},[s._v("#")]),s._v(" 安装node")]),s._v(" "),a("p",[s._v("作为前端开发者，应用在成型后部署需要安装node环境。")]),s._v(" "),a("h3",{attrs:{id:"_1-下载node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载node"}},[s._v("#")]),s._v(" 1. 下载node")]),s._v(" "),a("p",[s._v("我们可以使用着多种方式下载安装node，比如：")]),s._v(" "),a("h4",{attrs:{id:"_1-1-使用-wget-安装方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-使用-wget-安装方式"}},[s._v("#")]),s._v(" 1.1 使用 wget 安装方式")]),s._v(" "),a("p",[s._v("先通过ssh命令登录到远程服务器")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ssh 用户名@服务器ip\nwget https://registry.npmmirror.com/-/binary/node/latest-v16.x/node-v16.15.0.tar.xz\n")])])]),a("p",[s._v("如果linux服务器没有"),a("code",[s._v("wget")]),s._v("命令，先通过"),a("code",[s._v("yum")]),s._v("进行安装")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n")])])]),a("h4",{attrs:{id:"_1-2-官网手动下载-lrzsz-上传到服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-官网手动下载-lrzsz-上传到服务器"}},[s._v("#")]),s._v(" 1.2 "),a("code",[s._v("官网手动下载")]),s._v(" + "),a("code",[s._v("lrzsz")]),s._v(" 上传到服务器")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://nodejs.org/en/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载链接："),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("下载到本地之后\n可以通过"),a("code",[s._v("lrzsz")]),s._v(","),a("code",[s._v("put")]),s._v(","),a("code",[s._v("ftp")]),s._v(","),a("code",[s._v("scp")]),s._v(","),a("code",[s._v("curl")]),s._v("等工具传输到服务器。")]),s._v(" "),a("h5",{attrs:{id:"使用lrzsz上传-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用lrzsz上传-推荐"}},[s._v("#")]),s._v(" 使用"),a("code",[s._v("lrzsz")]),s._v("上传（推荐）")]),s._v(" "),a("ul",[a("li",[s._v("mac使用"),a("a",{attrs:{href:"https://iterm2.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("item2"),a("OutboundLink")],1),s._v("命令行工具，需要对"),a("code",[s._v("iTerm2")]),s._v("进行"),a("a",{attrs:{href:"https://github.com/snow-sprite/rzsz",target:"_blank",rel:"noopener noreferrer"}},[s._v("扩展安装lrzsz"),a("OutboundLink")],1),s._v("，这样Mac才可以使用"),a("code",[s._v("rz")]),s._v("和"),a("code",[s._v("sz")]),s._v("命令进行文件传输")]),s._v(" "),a("li",[s._v("windows使用"),a("a",{attrs:{href:"https://www.xshell.com/zh/xshell/",target:"_blank",rel:"noopener noreferrer"}},[s._v("XShell"),a("OutboundLink")],1),s._v("命令行终端。")])]),s._v(" "),a("p",[s._v("登录上linux服务器之后，输入"),a("code",[s._v("rz")]),s._v("命令，如果没有安装"),a("code",[s._v("lrzsz")]),s._v("，先进行安装")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" lrzsz\n")])])]),a("p",[s._v("然后输入"),a("code",[s._v("rz")]),s._v("命令，就会唤起上传弹窗，让你选择本地文件。")]),s._v(" "),a("h3",{attrs:{id:"_2-解压node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-解压node"}},[s._v("#")]),s._v(" 2. 解压node")]),s._v(" "),a("p",[a("code",[s._v("/usr/local/")]),s._v(": 系统额外安装软件所安装的目录\nssh登录进入服务器之后，执行命令：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建node目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动node压缩包->node文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /root/node-v16.15.0.tar.xz ./\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf node-v16.15.0.tar.xz\n")])])]),a("h3",{attrs:{id:"_3-建立软连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-建立软连接"}},[s._v("#")]),s._v(" 3. 建立软连接")]),s._v(" "),a("p",[s._v("其实到这一步，已经算是安装完成了，使用 "),a("code",[s._v("node -v")]),s._v(" 和 "),a("code",[s._v("npm -v")]),s._v(" 可以查看到安装的版本，但是在全局环境下会发现报错，所以需要建立软连接，就是将 Nodejs 安装 bin 目录下的可执行文件链接到 "),a("code",[s._v("/usr/local/bin")]),s._v(" 或 "),a("code",[s._v("/usr/bin")]),s._v(" 目录下。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node/node-v16.15.0-linux-x64/bin/node /usr/local/bin/node\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node/node-v16.15.0-linux-x64/bin/npm /usr/local/bin/npm\n")])])]),a("p",[s._v("然后再次执行")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" -v\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v\n")])])]),a("p",[s._v("可以显示具体安装的版本号，则说明已经安装成功了")]),s._v(" "),a("h2",{attrs:{id:"安装nginx及其依赖库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx及其依赖库"}},[s._v("#")]),s._v(" 安装nginx及其依赖库")]),s._v(" "),a("p",[s._v("代码推到服务器后,现在需要启动Nginx服务来访问前端页面")]),s._v(" "),a("h3",{attrs:{id:"_1-安装编译工具及库文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装编译工具及库文件"}},[s._v("#")]),s._v(" 1. 安装编译工具及库文件")]),s._v(" "),a("p",[a("code",[s._v("gcc")]),s._v("是"),a("code",[s._v("linux")]),s._v("下的编译器，它可以编译 "),a("code",[s._v("C,C++,Ada,Object C和Java")]),s._v("等语言")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc\n\n")])])]),a("h3",{attrs:{id:"_2-安装pcre"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装pcre"}},[s._v("#")]),s._v(" 2. 安装PCRE")]),s._v(" "),a("p",[a("code",[s._v("pcre")]),s._v("是一个"),a("code",[s._v("perl")]),s._v("库，包括"),a("code",[s._v("perl")]),s._v("兼容的正则表达式库，"),a("code",[s._v("nginx")]),s._v("的"),a("code",[s._v("http模块")]),s._v("使用"),a("code",[s._v("pcre")]),s._v("来解析正则表达式，所以需要安装"),a("code",[s._v("pcre")]),s._v("库")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y pcre pcre-devel\n\n")])])]),a("h3",{attrs:{id:"_3-zlib安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-zlib安装"}},[s._v("#")]),s._v(" 3. zlib安装")]),s._v(" "),a("p",[a("code",[s._v("zlib")]),s._v("库提供了很多种压缩和解压缩方式"),a("code",[s._v("nginx")]),s._v("使用"),a("code",[s._v("zlib")]),s._v("对"),a("code",[s._v("http")]),s._v("包的内容进行"),a("code",[s._v("gzip")]),s._v("，所以需要安装")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y pcre pcre-devel\n\n")])])]),a("h3",{attrs:{id:"_4-安装openssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装openssl"}},[s._v("#")]),s._v(" 4. 安装openssl")]),s._v(" "),a("p",[a("code",[s._v("openssl")]),s._v("是"),a("code",[s._v("web")]),s._v("安全通信的基石，没有"),a("code",[s._v("openssl")]),s._v("，可以说我们的信息都是在裸奔")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y pcre pcre-devel\n\n")])])]),a("h3",{attrs:{id:"_5-安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-安装nginx"}},[s._v("#")]),s._v(" 5. 安装Nginx")]),s._v(" "),a("h4",{attrs:{id:"_5-1-下载稳定版本的nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-下载稳定版本的nginx"}},[s._v("#")]),s._v(" 5.1 下载稳定版本的Nginx")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.22.0.tar.gz\n")])])]),a("h4",{attrs:{id:"_5-2-把压缩包解压到usr-local-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-把压缩包解压到usr-local-nginx"}},[s._v("#")]),s._v(" 5.2 把压缩包解压到usr/local/nginx")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf nginx-1.22.0.tar.gz\n")])])]),a("h4",{attrs:{id:"_5-3-编译安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-编译安装"}},[s._v("#")]),s._v(" 5.3 编译安装")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.22.0\n./configure \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),a("h3",{attrs:{id:"_6-建立软连接-启动nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-建立软连接-启动nginx"}},[s._v("#")]),s._v(" 6. 建立软连接,启动Nginx")]),s._v(" "),a("p",[s._v("其实到这一步，已经算是安装完成了")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin/\nnginx -v\n")])])]),a("p",[s._v("可以查看到安装的版本，但是在全局环境下会发现找不到该命令，所以需要建立软连接，就是将 "),a("code",[s._v("Nginx")]),s._v(" 安装 "),a("code",[s._v("sbin目录")]),s._v("下的可执行文件链接到 "),a("code",[s._v("/usr/local/bin")]),s._v(" 或 "),a("code",[s._v("/usr/bin")]),s._v(" 目录下。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/nginx/sbin/nginx /usr/local/bin/nginx\n")])])]),a("p",[s._v("然后前往根目录，再次执行")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("nginx -v\n")])])]),a("p",[s._v("可以显示具体安装的版本号，则说明已经配置成功了")]),s._v(" "),a("p",[s._v("查找安装路径")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whereis")]),s._v(" nginx\n")])])]),a("p",[s._v("常用的"),a("code",[s._v("Nginx")]),s._v("命令:")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动、停止nginx")]),s._v("\nnginx     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启nginx服务")]),s._v("\nnginx -s stop  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止，直接查找nginx进程id再使用kill命令强制杀掉进程")]),s._v("\nnginx -s quit  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退出停止，等待nginx进程处理完任务再进行停止")]),s._v("\nnginx -s reload  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新加载配置文件，修改nginx.conf后使用该命令，新配置即可生效")]),s._v("\n")])])]),a("p",[s._v("启动"),a("code",[s._v("Nginx")]),s._v(" 默认端口80 如果端口有冲突可以修改端口")]),s._v(" "),a("p",[s._v("访问页面查看"),a("code",[s._v("Nginx")]),s._v("是否正常启动\n如果页面显示 "),a("code",[s._v("Welcome to nginx!")]),s._v(" 等字样，表明Nginx启动正常。\n如果页面没法正常启动，则检查服务器防火墙是否开启，安全组是否放行该端口等等。")]),s._v(" "),a("h2",{attrs:{id:"前端项目自动打包上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端项目自动打包上传"}},[s._v("#")]),s._v(" 前端项目自动打包上传")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("rsync")]),s._v("，"),a("code",[s._v("shelljs")]),s._v("，"),a("code",[s._v("yargs")]),s._v("等npm包实现项目文件的自动上传。")])]),s._v(" "),a("p",[s._v("这些包本质上其实都是执行"),a("code",[s._v("shell")]),s._v("命令，下面我们具体介绍如何使用shell脚本直接上传项目文件。")]),s._v(" "),a("h3",{attrs:{id:"_1-安装child-process"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装child-process"}},[s._v("#")]),s._v(" 1. 安装child_process")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("node")]),s._v("中，"),a("code",[s._v("child_process")]),s._v("这个模块非常重要。掌握了它，等于在node的世界开启了一扇新的大门。熟悉shell脚本的同学，可以用它来完成很多有意思的事情，比如文件压缩、增量部署等，nodejs创建子进程有四种方法,分别是"),a("code",[s._v("spawn")]),s._v("、"),a("code",[s._v("fork")]),s._v("、"),a("code",[s._v("exec")]),s._v("、"),a("code",[s._v("execFile")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" child_process -D\n")])])]),a("h3",{attrs:{id:"_2-添加自动部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加自动部署脚本"}},[s._v("#")]),s._v(" 2. 添加自动部署脚本")]),s._v(" "),a("p",[s._v("更改"),a("code",[s._v("package.json")]),s._v("，添加部署钩子")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ...\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ...\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"deploy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node deploy"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("通过"),a("code",[s._v("npm钩子")]),s._v("触发部署脚本"),a("code",[s._v("node deploy")]),s._v("，开始进行部署工作。"),a("code",[s._v("deploy.js")]),s._v("文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" execFile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'child_process'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm_package_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("shell")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stderr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("这里利用了"),a("code",[s._v("nodejs")]),s._v("的 "),a("code",[s._v("child_process")]),s._v(" 模块执行子进程，调用了"),a("code",[s._v("execFile")]),s._v("执行了 "),a("code",[s._v("deploy.sh")]),s._v("，并将"),a("code",[s._v("npm包")]),s._v("版本号作为参数传递给了"),a("code",[s._v("deploy.sh")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("deploy.sh")]),s._v("文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("distdir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./dist"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("htmldir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/html"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hw-cloud"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${distdir}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${host}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${htmldir}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${host}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("eeooff\ncd "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${htmldir}")]),s._v('\nrsync -auv ./dist/assets/* ./assets\nrsync -auv --exclude="./dist/assets" ./dist/* ./\n\nrm -rf '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${htmldir}")]),s._v("/dist\n\nexit\neeooff")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),a("p",[s._v("以上命令主要做的事情是：")]),s._v(" "),a("p",[a("code",[s._v("npm run build")]),s._v("执行构建任务\n将构建得到的"),a("code",[s._v("dist文件夹")]),s._v("中的内容通过"),a("code",[s._v("scp")]),s._v("传输到服务器。\n登录远程服务器，执行的脚本内容在"),a("code",[s._v("<< eeooff")]),s._v("至"),a("code",[s._v("eeooff")]),s._v("之间。\n在结束前，加exit退出远程节点。")]),s._v(" "),a("h2",{attrs:{id:"部署node后端服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署node后端服务"}},[s._v("#")]),s._v(" 部署node后端服务")]),s._v(" "),a("h3",{attrs:{id:"_1-安装mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装mysql"}},[s._v("#")]),s._v(" 1. 安装mysql")]),s._v(" "),a("p",[s._v("centOS服务器安装配置mysql，具体步骤点"),a("a",{attrs:{href:"https://help.aliyun.com/document_detail/188447.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("\n安装完成之后，可以使用"),a("a",{attrs:{href:"https://navicat.com.cn/products",target:"_blank",rel:"noopener noreferrer"}},[s._v("Navicat"),a("OutboundLink")],1),s._v("，"),a("code",[s._v("MySQL Workbench")]),s._v("等工具进行测试和查看。")]),s._v(" "),a("h3",{attrs:{id:"_2-项目配置pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-项目配置pm2"}},[s._v("#")]),s._v(" 2. 项目配置pm2")]),s._v(" "),a("p",[a("code",[s._v("pm2")]),s._v("（process manager）是一个进程管理工具，维护一个进程列表，可以用它来管理你的node进程，负责所有正在运行的进程，并查看node进程的状态，也支持性能监控，负载均衡等功能。")]),s._v(" "),a("h4",{attrs:{id:"_1-1、使用pm2管理的node程序的好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1、使用pm2管理的node程序的好处"}},[s._v("#")]),s._v(" 1.1、使用pm2管理的node程序的好处")]),s._v(" "),a("ul",[a("li",[s._v("监听文件变化，自动重启程序")]),s._v(" "),a("li",[s._v("支持性能监控")]),s._v(" "),a("li",[s._v("能够负载均衡CPU")]),s._v(" "),a("li",[s._v("内存使用过多/CPU调度太频繁，重启，程序崩溃自动重启")]),s._v(" "),a("li",[s._v("服务器重新启动时自动重新启动")]),s._v(" "),a("li",[s._v("自动化部署项目")])]),s._v(" "),a("h4",{attrs:{id:"_1-2、pm2安装与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、pm2安装与使用"}},[s._v("#")]),s._v(" 1.2、pm2安装与使用")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pm2\n")])])]),a("p",[s._v("安装之后，配置"),a("code",[s._v("pm2.json")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/main.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 实际启动脚本")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cwd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前工作路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"instances"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 根据CPU核心数启动子进程实例")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启动集群")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"exec_mode"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 监控变化的目录，一旦变化，自动重启")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ignore_watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从监控目录中排除")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"watch_options"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"followSymlinks"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"error_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./logs/app-err.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 错误日志路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"out_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./logs/app-out.log"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 普通日志路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("然后更改"),a("code",[s._v("package.json")]),s._v("，添加启动钩子")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ...\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ...\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pm2"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production pm2 start pm2.json"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("code",[s._v("pm2")]),s._v("可以通过"),a("code",[s._v("pm2 monit")]),s._v("命令，查看当前通过pm2运行的进程的状态。\n也可以使用"),a("a",{attrs:{href:"https://keymetrics.pm2.io/#/",target:"_blank",rel:"noopener noreferrer"}},[s._v("在线监控系统"),a("OutboundLink")],1),s._v("，方便的对进程的服务情况进行在线监控。")]),s._v(" "),a("h3",{attrs:{id:"_3-配置自动部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置自动部署脚本"}},[s._v("#")]),s._v(" 3. 配置自动部署脚本")]),s._v(" "),a("p",[s._v("可以配置"),a("code",[s._v("git钩子")]),s._v("在pre-push阶段自动运行"),a("code",[s._v("node deploy.js")]),s._v("命令，开始进行部署工作。"),a("code",[s._v("deploy.js")]),s._v("文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" execFile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'child_process'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm_package_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("shell")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stderr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("然后修改"),a("code",[s._v("deploy.sh")]),s._v("文件，内容如下：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("serverDir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/server"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hw-cloud"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -auv --exclude"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./node_modules"')]),s._v(" ./ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${host}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${serverDir}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${host}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("eeooff\ncd "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${serverDir}")]),s._v("\npnpm install --production\nnpm run pm2\n\nexit\neeooff")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" done"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])])]),a("h2",{attrs:{id:"ci-cd持续集成部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd持续集成部署"}},[s._v("#")]),s._v(" CI/CD持续集成部署")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("我们在开发一个新项目时,总是需要将前端部署到测试服务器上，给测试或者产品访问。简单的来说，如果想部署前端到服务器，服务器需要提供一个服务来访问前端。如果我们在开发中没有涉及"),a("code",[s._v("Node.js")]),s._v("，那我们需要服务器提供一个服务来访问前端，可能是"),a("code",[s._v("IIS服务")]),s._v("，"),a("code",[s._v("Nginx服务")]),s._v("亦或"),a("code",[s._v("Tomcat服务")]),s._v("，不论部署到哪里，当前端代码频繁更新时(尤其开发阶段)，我们需要不停的打包去替换服务器上的代码。可能由运维帮我们替换，也可能是我们自己通过ftp的方式进行替换。这种方式会比较繁琐。")])]),s._v(" "),a("p",[s._v("项目的持续集成部署可以查看另一篇文章，"),a("RouterLink",{attrs:{to:"/blog/ops/linux-ci-cd.html"}},[s._v("项目CI/CD持续集成部署方案，看这一篇就够了")])],1)])}),[],!1,null,null,null);t.default=e.exports}}]);